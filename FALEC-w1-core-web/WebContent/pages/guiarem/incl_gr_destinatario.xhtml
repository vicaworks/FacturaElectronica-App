<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:o="http://omnifaces.org/ui"
				xmlns:of="http://omnifaces.org/functions">
	
	<style type="text/css">
		
		.guiaRemDestinatarioDT .ui-datascroller-content{
				min-height: 40vh !important;
				height: calc(100vh - 210px);
		}
		
	</style>
	
	<div class="card">
		<p:dataScroller id="guiaRemDestinatarioDT" value="#{guiaRemFormCtrl.guiaRemisionSelected.destinatarioList}" var="d" chunkSize="10" mode="inline" styleClass="guiaRemDestinatarioDT">
			<f:facet name="header">
            	<div class="flex justify-content-between align-items-end">
            		<span class="fs-14 text-gray-900">Destinatarios</span>
	                <div class="flex gap-2">
						<p:commandButton id="cmdGrNuevoDestinatario" process="@this :formMain:guiaRemDestinatarioDT"
							oncomplete="PrimeFaces.focus('frmListProducto:intListProBusqueda');"
							action="#{ventasQueryCtrl.cargarFormulario()}" 
							styleClass="ui-button-primary min-width-80 fs-12"
							icon="fa fa-search fs-12"
							value="Facturas">
							<f:setPropertyActionListener value="#{guiaRemFormCtrl.establecimientoMain}" target="#{ventasQueryCtrl.establecimientoMain}"/>
							<f:setPropertyActionListener value="GUIA_REMISION" target="#{ventasQueryCtrl.callModule}"/>
							<f:setPropertyActionListener value="formMain" target="#{ventasQueryCtrl.callForm}"/>
							<f:setPropertyActionListener value=":formMain" target="#{ventasQueryCtrl.viewUpdate}"/>
						</p:commandButton>
						
						<p:commandButton id="cmdAdqAgregarDetalle" 
							process="@this :formMain:guiaRemDestinatarioDT"
							oncomplete="PrimeFaces.focus('frmListProducto:intListProBusqueda');"
							action="#{guiaRemFormCtrl.nuevoDestinatario()}" 
							styleClass="ui-button-outlined ui-button-secondary min-width-80 fs-12"
							icon="fa fa-plus fs-12"
							value="Agregar">
						</p:commandButton>			
	                </div>
            	</div>
            </f:facet>
            
            <div class="grid border-bottom-1 border-blue-100 mb-1 pb-1">
            	<div class="col-12">
            		<div class="flex flex-column mb-1 gap-1">
						<span class="fs-14 text-primary-600 font-semibold">#{d.razonsocialdestinatario}</span>
						<span class="text-gray-900 fs-12">#{d.identificaciondestinatario}</span>
						<div class="flex gap-2 fs-12">
							<i class="fa-solid fa-location-dot fs-12"></i>
							<span class="text-gray-900">#{d.dirdestinatario}</span>
						</div>
						<span class="text-gray-900 fs-11">Motivo de traslado</span>
						<span class="text-gray-900 fs-12">#{d.motivotraslado}</span>
						<span class="text-gray-900 font-semibold">#{d.tipocomprobante.comprobante}</span>
						
						<div class="flex justify-content-between">
							<span class="text-gray-900 font-semibold fs-12">#{guiaRemFormCtrl.getFormatoNumDocumento(d.numdocsustento)}</span>
							<h:outputText value="#{d.fechaemisiondocsustento}"  styleClass="text-gray-900">
								<f:convertDateTime pattern="dd/MM/yyyy"/>
							</h:outputText>
						</div>
						
						
						<span class="text-gray-900 fs-11">Número de autorización</span>
						<span class="text-gray-800 font-semibold font-semibold fs-10">#{d.numautdocsustento}</span>
						<span class="text-gray-900 fs-11">Código de establecimiento de destino</span>
						<span class="text-gray-800 font-semibold fs-11">#{d.codestabdestino!=null?d.codestabdestino:'-'}</span>
						<span class="text-gray-900 fs-11">Ruta</span>
						<span class="text-gray-800 font-semibold fs-11">#{d.ruta!=null?d.ruta:'-'}</span>
						<span class="text-gray-900 fs-11">Documento aduanero único</span>
						<span class="text-gray-800 font-semibold fs-11">#{d.docaduanerounico!=null?d.docaduanerounico:'-'}</span>
					</div>
					<div class="flex my-1 justify-content-start gap-2">					
						<p:commandLink action="#{guiaRemFormCtrl.editarDestinatario()}" 
							styleClass="p-3 det-item-hover" 
           					style="border-radius:100%; border: 1px solid #b3d7ff;width:4.1rem;height:4.1rem;" 
							process="@this">
							<i class="fa fa-edit fs-18 text-gray-900"></i>
							<f:setPropertyActionListener value="#{d}" target="#{guiaRemFormCtrl.destinatarioSelected}"/>
						</p:commandLink>
						<p:commandLink action="#" 
							styleClass="p-3 det-item-hover" 
           					style="border-radius:100%; border: 1px solid #b3d7ff;width:4.1rem;height:4.1rem;" 
							process="@this" 
							update="@form:oupGuiaRemDetalleDT">
							<i class="fa-regular fa-folder-open fs-18 text-gray-900"></i>
							<f:setPropertyActionListener value="#{d}" target="#{guiaRemFormCtrl.destinatarioSelected}"/>
						</p:commandLink>
						<p:commandLink action="#{guiaRemFormCtrl.eliminarDestinatario()}" 
							styleClass="p-3 det-item-hover" 
           					style="border-radius:100%; border: 1px solid #b3d7ff;width:4.1rem;height:4.1rem;" 
							process="@this" 
							update="@form:guiaRemDestinatarioDT @form:guiaRemDetalleDT @form:oupGuiaRemDetalleDT @form:oupTotDestinatario">
							<i class="fa-regular fa-trash-can fs-18 text-gray-900"></i>
							<p:confirm header="#{msg['label.confirmacion']}" message="#{msg['mensaje.confimacion']}" icon="fa fw-3x fa-exclamation-triangle" />
							<f:setPropertyActionListener value="#{d}" target="#{guiaRemFormCtrl.destinatarioSelected}"/>
						</p:commandLink>
					</div>
            	</div>
            </div>
            
            
       </p:dataScroller>		
		<p:outputPanel id="oupTotDestinatario" styleClass="flex justify-content-between">
			<div>
				<span class="fs-12 text-gray-800 mr-2n align-self-end">Destinatarios</span>
				<span class="fs-20 text-primary-600 font-semibold">
					<h:outputText value="#{guiaRemFormCtrl.guiaRemisionSelected.cantidadDestinatario}" styleClass="font-bold" >
						<f:convertNumber pattern="#,##0"/>
					</h:outputText>
				</span>
			</div>
			<div>
				<span class="fs-12 text-gray-800 mr-2n align-self-end">Productos</span>
				<span class="fs-20 text-primary-600 font-semibold">
					<h:outputText value="#{guiaRemFormCtrl.guiaRemisionSelected.total}" styleClass="font-bold" >
						<f:convertNumber pattern="#,##0.##"/>
					</h:outputText>
				</span>
			</div>
		</p:outputPanel>
	</div>
	
</ui:composition>
