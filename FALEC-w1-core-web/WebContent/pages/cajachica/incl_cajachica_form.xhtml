<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:o="http://omnifaces.org/ui"
				xmlns:of="http://omnifaces.org/functions">
	
	<style type="text/css">
		
 		.heightFrmCajaChica {
		} 
		
	</style>
	
	<script >
		PrimeFaces.widget.Dialog.prototype.applyFocus = function () {
	        var firstInput = this.jq.find(':not(:submit):not(:button):input:visible:enabled:first');
	        if (!firstInput.hasClass('hasDatepicker')) {
	            firstInput.focus();
	        }
	    }
	</script>
	<p:dialog header="Caja chica" 
		widgetVar="dlgcajaChica" 
		modal="true" 
		responsive="true" 
		width="99%"
		style="max-width: 80rem;" 
		closeOnEscape="true" 
		styleClass="modalResponsivo">
		
		<h:form id="formCC">
			<!-- consulta proveedor return keycode 13 -->
			<p:remoteCommand name="buscarProveedor"  action="#{cajaChicaCtrl.buscarProveedor()}" process="@this :formCC:inpCriterioProveedor" update=":formCC:msgformCC :formCC:msgInpCriterioProveedor :formCC:gridProveedor"/>
			
			
			<!-- OPCIONES -->
			<div class="tool-bar">
				<i class="fa-solid fa-ellipsis-vertical"></i>
				<p:commandButton id="cmdGuardarCCForm"
					value="Guardar" icon="fa-regular fa-floppy-disk fs-13" 
					action="#{cajaChicaCtrl.guardar()}" 
					styleClass="ui-button ui-button-success min-width-100 fs-13" 
					update="@form :formMain" 
					disabled="#{not cajaChicaCtrl.flagGuardar}"
					/>
				
				<p:commandButton id="cmdNuevoCCForm"
					value="Nuevo" icon="fa fa-plus" 
					action="#{cajaChicaCtrl.nuevo()}" 
					styleClass="ui-button-outlined min-width-100 fs-13" 
					update="@form" process="@this"/>
				
				<p:commandButton id="cmdCerrarCCForm"
					value="Cerrar" 
					icon="fa fa-sign-out" 
					styleClass="min-width-100 ui-button-outlined ui-button-secondary fs-13" 
					onclick="PF('dlgcajaChica').hide()" immediate="true"  
					/>				
				
			</div>
			
			<p:messages rendered="#{not facesContext.validationFailed}" showSummary="true" showDetail="true" for="formCC" id="msgformCC"
				closable="true" >
				<p:autoUpdate></p:autoUpdate>
			</p:messages>
			
			<!--  wraper del formulario para responsive -->
			
			<div class="w-full overflow-auto heightFrmCajaChica contenedorFormulario mt-2 pr-1 ui-fluid fs-12">
				
				<div class="grid align-content-start" style="width: 99.5%!important;">
					
					<!-- VALORES -->
					<div class="col-12 md:col-6">
						<div class="field">							
							<label class="text-gray-800 fw-5">Fecha registro</label>
							<p:calendar id="calCCfechaEmision" value="#{cajaChicaCtrl.transaccionSelected.fechaemision}"
								pattern="dd/MM/yyyy"
								locale="es" 
								requiredMessage="Requerido" required="true"
								placeholder="dd/MM/yyyy">
							</p:calendar>
							<p:message for="calCCfechaEmision" styleClass="block m-0 p-0"/>
					    </div>
					    <p:outputPanel class="field" id="gridOPC">	
					    	<label class="text-gray-800 fw-5">Tipo de transacción</label>							
							<div class="flex">
								<div class="flex-grow-1 flex overflow-hidden">
									<p:selectOneMenu id="somCCConcepto"
										value="#{cajaChicaCtrl.transaccionSelected.transaccionconcepto}"
										converter="omnifaces.SelectItemsConverter"
										required="true"
										requiredMessage="Requerido"
										styleClass="w-full"
										style="text-overflow: ellipsis!important"
										filter="true"
										filterMatchMode="contains">
										<f:selectItem itemLabel="Seleccionar...." itemValue="#{null}"/>
										<f:selectItems value="#{cajaChicaCtrl.transaccionconceptoList}" var="c"
													itemLabel="#{c.nombre}" itemValue="#{c}" />
										<p:ajax event="change" process="@this :formCC:gridOPC" update=":formCC:gridOPC"/>
									</p:selectOneMenu>	
								</div>
								<div class="flex gap-2 align-items-end justify-content-end" 
									style="flex: 0; align-items: stretch; flex-basis: 4rem;">
									<p:commandLink action="#{tranConceptoCtrl.nuevoEditar(null)}" process="@this" styleClass="text-gray-900">
										<i class="fa-solid fa-file fs-16"></i>
										<f:setPropertyActionListener value="CAJACHICA" target="#{tranConceptoCtrl.callModule}"></f:setPropertyActionListener>
										<f:setPropertyActionListener value=":formCC:msgformCC :formCC:gridOPC" target="#{tranConceptoCtrl.updateView}"></f:setPropertyActionListener>
										<f:setPropertyActionListener value="#{cajaChicaCtrl}" target="#{tranConceptoCtrl.cajaChicaCtrl}"></f:setPropertyActionListener>
									</p:commandLink>								
									<p:commandLink
										id="cmlEditarTipoTransaccion" 
										action="#{tranConceptoCtrl.nuevoEditar(cajaChicaCtrl.transaccionSelected.transaccionconcepto.idtransaccionconcepto)}" 
										disabled="#{cajaChicaCtrl.transaccionSelected.transaccionconcepto == null}" 
										process="@this :formCC:somCCConcepto" 
										styleClass="text-gray-900">
										<i class="fa fa-edit fs-16"></i>
										<f:setPropertyActionListener value="CAJACHICA" target="#{tranConceptoCtrl.callModule}"></f:setPropertyActionListener>
										<f:setPropertyActionListener value=":formCC:msgformCC :formCC:gridOPC" target="#{tranConceptoCtrl.updateView}"></f:setPropertyActionListener>
										<f:setPropertyActionListener value="#{cajaChicaCtrl}" target="#{tranConceptoCtrl.cajaChicaCtrl}"></f:setPropertyActionListener>
									</p:commandLink>
								</div>
							</div>
							<p:message for="somCCConcepto" styleClass="block m-0 p-0"/>
					    </p:outputPanel>
					    <div class="field">			
					    	<label class="text-gray-800 fw-5">Descripción</label>
							<p:inputTextarea maxlength="500" value="#{cajaChicaCtrl.transaccionSelected.nota}" rows="3"/>
					    </div>
					    <div class="field">							
					    	<label class="text-gray-800 fw-5">Reposición o gasto</label>
							<p:selectOneMenu id="somCCTipo"
								value="#{cajaChicaCtrl.transaccionSelected.tipoTransaccion}"
								required="true"
								requiredMessage="Requerido"
								filter="true"
								filterMatchMode="contains">
								<f:selectItem itemLabel="Seleccionar...." itemValue="#{null}"/>
								<f:selectItem itemLabel="#{msg['label.reposicion']}" itemValue="INGRESO"/>
								<f:selectItem itemLabel="Gasto" itemValue="EGRESO"/>
								<p:ajax event="change" update=":formCC:ipsCCValor" process="@this :formCC:ipsCCValor" oncomplete="PrimeFaces.focus('formCC:ipsCCValor');"/>
							</p:selectOneMenu>
							<p:message for="somCCTipo" styleClass="block m-0 p-0"/>
					    </div>
					    <div class="field">							
					    	<label class="text-gray-800 fw-5">Valor</label>					    	
					    	<p:inputNumber id="ipsCCValor" 
					    		value="#{cajaChicaCtrl.transaccionSelected.tipoTransaccion=='INGRESO' ? cajaChicaCtrl.transaccionSelected.valoringreso : cajaChicaCtrl.transaccionSelected.valoregreso}" 
					    		minValue="0"
                                maxValue="5000" 
                                decimalPlaces="2" 
                                disabled="#{empty cajaChicaCtrl.transaccionSelected.tipoTransaccion}"
                                styleClass="align-text: right;"/>
							<p:message for="ipsCCValor"
								styleClass="block m-0 p-0"/>
							
					    </div>
					    
					</div>
					
					
					<!-- DATOS CABECERA -->
					<div class="col-12 md:col-6">
						
						<div class="field">							
							<label class="text-gray-800">Proveedor</label>							
							<div class="flex">
								<div class="flex-grow-1 flex overflow-hidden">
									<div class="ui-inputgroup w-full">
					                    <p:inputText id="inpCriterioProveedor"
											value="#{cajaChicaCtrl.criterioProveedor}" required="false"
											requiredMessage="Requerido" styleClass="w-full Fs12"
											maxlength="13" placeholder="C.I. o RUC / ENTER PARA BUSCAR"
											validatorMessage="SOLO NUMEROS"
											onkeydown="if(event.keyCode==13){event.keyCode=123;buscarProveedor(); return false;}">
										<f:validateRegex pattern="^\d+$" />
										</p:inputText>
					                    <p:commandButton icon="pi pi-search" styleClass="ui-button-success" process="@this :formCC:inpCriterioProveedor"
												update=":formCC:msgformCC :formCC:msgInpCriterioProveedor :formCC:gridProveedor" 
												action="#{cajaChicaCtrl.buscarProveedor()}"/>
					                </div>
								</div>
								<div class="flex gap-2 align-items-end justify-content-end" 
									style="flex: 0; align-items: stretch; flex-basis: 4rem;">
									<p:commandLink action="#{clienteCtrl.nuevoEditar(cajaChicaCtrl.transaccionSelected.cliente!=null?cajaChicaCtrl.transaccionSelected.cliente.idcliente:null)}" 
										process="@this :formCC:inpCriterioProveedor" 
										styleClass="text-gray-900">
										<i class="fa-solid fa-file fs-16"></i>
										<f:setPropertyActionListener value="CAJACHICA" target="#{clienteCtrl.callModule}"/>
										<f:setPropertyActionListener value=":formCC:gridProveedor" target="#{clienteCtrl.updateView}"/>
										<f:setPropertyActionListener value="#{cajaChicaCtrl}" target="#{clienteCtrl.cajaChicaCtrl}"/>
									</p:commandLink>								
									<p:commandLink action="#{clienteCtrl.nuevoEditar(cajaChicaCtrl.transaccionSelected.cliente!=null?cajaChicaCtrl.transaccionSelected.cliente.idcliente:null)}" 
										process="@this :formCC:inpCriterioProveedor" 
										styleClass="text-gray-900">
										<i class="fa fa-edit fs-16"></i>
										<f:setPropertyActionListener value="CAJACHICA" target="#{clienteCtrl.callModule}"/>
										<f:setPropertyActionListener value=":formCC:gridProveedor" target="#{clienteCtrl.updateView}"/>
										<f:setPropertyActionListener value="#{cajaChicaCtrl}" target="#{clienteCtrl.cajaChicaCtrl}"/>
									</p:commandLink>
								
								</div>
							</div>
			                <p:message id="msgInpCriterioProveedor" 
			                	for="inpCriterioProveedor" 
			                	styleClass="block m-0 p-0"/>
					    </div>
						
						
						<p:outputPanel id="gridProveedor" styleClass="w-full mb-1" style="height:9.53rem;">
							<p:skeleton styleClass="w-full mt-1" height="9.35rem" rendered="#{cajaChicaCtrl.transaccionSelected.cliente==null}"/>
							<f:subview rendered="#{cajaChicaCtrl.transaccionSelected.cliente!=null}">
								<div class="flex flex-column">
									<span class="fs-16 text-blue-600 mb-1 block">
										<h:outputText value="#{cajaChicaCtrl.transaccionSelected.cliente.razonsocial!=null?cajaChicaCtrl.transaccionSelected.cliente.razonsocial:'-'}" />
									</span>
									<span class="fs-11 fw-5 text-gray-800 mb-1 block">
										<h:outputText value="#{cajaChicaCtrl.transaccionSelected.cliente.identificacion!=null?cajaChicaCtrl.transaccionSelected.cliente.identificacion:'-'}" />
									</span>
									<span class="fs-10 mb-1 flex align-items-baseline gap-1 text-gray-900">
										<i class="pi pi-map-marker"></i>
										<h:outputText value="#{cajaChicaCtrl.transaccionSelected.cliente.direccion!=null?cajaChicaCtrl.transaccionSelected.cliente.direccion:'-'}" />
									</span>
									<span class="fs-10 mb-1 flex align-items-baseline gap-1 text-gray-900">
										<i class="pi pi-phone"></i>
										<h:outputText value="#{cajaChicaCtrl.transaccionSelected.cliente.telefono!=null?cajaChicaCtrl.transaccionSelected.cliente.telefono:'-'}" />
									</span>
									<span class="fs-10 mb-1 flex align-items-baseline gap-1 text-gray-900">
										<i class="pi pi-envelope fs-11"></i>
										<h:outputText value="#{cajaChicaCtrl.transaccionSelected.cliente.correoelectronico!=null?cajaChicaCtrl.transaccionSelected.cliente.correoelectronico:'-'}" />
									</span>
								</div>
							</f:subview>
						</p:outputPanel>
						
						<div class="field">				
							<label class="text-gray-800">Factura de gasto</label>
							<p:inputText id="inptDocReferencia" 
								value="#{cajaChicaCtrl.transaccionSelected.numdocumento}" 
								maxlength="20" 
								required="false" 
								requiredMessage="Requerido">
							</p:inputText>
							<p:message for="inptDocReferencia" 
								styleClass="block m-0 p-0"/>
					    </div>
						
					</div>
					
				</div>
				
			</div>
			
		</h:form>
		
   </p:dialog>  
    

</ui:composition>
