<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:o="http://omnifaces.org/ui"
				xmlns:of="http://omnifaces.org/functions">
	
	<style type="text/css">
		.notMotivoDT .ui-datatable-scrollable-body{
				min-height: 25vh !important;
				height: calc(100vh - 400px);
			}
		
		.notMotivoDT .ui-inputnumber .ui-inputfield{height: 100%!important;text-align: center;font-size: 14px;width: 95px;max-width: 95px;}
		
		.oupNcTotal .ui-selectonemenu-label {text-align: right!important;padding-right: 2rem!important;}
		
	</style>
	
	
		<div class="card">
			
			<div class="flex justify-content-end">
				<p:commandButton id="cmdNCAgregarDetalle" 
               		process="@this :formMain:notMotivoDT"
					update=":formMain:notMotivoDT"
					oncomplete="PrimeFaces.focus('frmListProducto:intListProBusqueda');"
					action="#{notaDebitoFrmCtrl.agregarItem()}" 
               		value="Agregar detalle" 
               		styleClass="fs-12 min-width-80" 
               		icon="fa fa-plus fs-12">
               		<f:setPropertyActionListener value="NOTA_CREDITO" target="#{listaProductoCtrl.callModule}"/>
					<f:setPropertyActionListener value="NUEVO" target="#{listaProductoCtrl.accion}"/>
					<f:setPropertyActionListener value=":formMain:pvDetalleDT :formMain:oupNcTotal" target="#{listaProductoCtrl.viewUpdate}"/>
					<f:setPropertyActionListener value="formMain" target="#{listaProductoCtrl.formModule}"/>
					<f:setPropertyActionListener value="#{notaCreditoCtrl}" target="#{listaProductoCtrl.notaCreditoCtrl}"/>
					<f:setPropertyActionListener value="#{notaCreditoCtrl.establecimientoMain}" target="#{listaProductoCtrl.establecimientoMain}"/>
               	</p:commandButton>	
			</div>
			
			
			<p:dataTable id="notMotivoDT" var="r"
						value="#{notaDebitoFrmCtrl.motivoList}" scrollable="true"
						emptyMessage="#{msg['mensaje.noexistenDatos']}"
						styleClass="notMotivoDT Fs11"  
						rowKey="#{r.idmotivo}">
						
								
				<p:column headerText="Motivo" style="width:80%;">
				
					<div class="flex gap-2 align-items-center">
						<p:commandLink  action="#{notaDebitoFrmCtrl.eliminarDetalle()}" process="@this" update="@form:notMotivoDT @form:oupNcTotal" disabled="#{notaDebitoFrmCtrl.enableAccion}">
							<f:setPropertyActionListener value="#{r}" target="#{notaDebitoFrmCtrl.motivoSelected}"/>
							<i class="fa-regular fa-trash-can fs-16" style="color:#2f2f2f;"></i>
							<p:confirm header="#{msg['label.confirmacion']}" message="#{msg['mensaje.confimacion']}" icon="fa fw-3x fa-exclamation-triangle" />
						</p:commandLink>
						<p:inputText id="intNdMotivo" 
							value="#{r.razon}" 
							maxlength="300" 
							required="true" 
							requiredMessage="Requerido" 
							styleClass="flex-1 fs-14"></p:inputText>
					</div>
					<p:message for="intNdMotivo" styleClass="block m-0 p-0"/>
				</p:column>
				<p:column headerText="Valor" style="width:20%;">
					
					<p:inputNumber id="intNdValor" 
						value="#{r.valor}" 
						symbol="$" 
						onkeydown="if(event.keyCode==13){event.keyCode=9;return false;}"
                  		symbolPosition="p" 
                  		emptyValue="zero" 
                  		decimalPlaces="2"
                  		styleClass="w-full">
                		<p:ajax listener="#{notaDebitoFrmCtrl.calcularIvaAction()}" update="@form:notMotivoDT @form:oupNcTotal" process="@this @form:notMotivoDT"/>
                	</p:inputNumber>	
					<p:message for="intNdValor" styleClass="block m-0 p-0"/>
				</p:column>
				
						
			</p:dataTable>
			
			
			<!-- subtotales -->
			<p:outputPanel id="oupNcTotal" styleClass="w-full oupNcTotal">
				<div class="grid">
					<div class="col-12 md:col-7">
						<div class="grid grid-nogutter justify-content-between">
							<div class="col-8 py-1">
								<div class="w-full">
									<span class="fs-12 mr-1 text-gray-700 font-semibold">Resumen</span>
									<span class="fs-14 text-blue-600 font-medium">TOTALES</span>
								</div>
							</div>
							<div class="col-1 text-center align-self-center">
								<i class="fa fa-angle-down fs-14"></i>
							</div>
							<div class="col-12 mt-1">
								
								<div class="flex mt-1 border-bottom-1 border-blue-100 py-2 align-items-end">
									<div class="flex flex-grow-1 fs-11">
										<i class="fa fa-angle-right mr-1 font-bold"></i>
										<span class="text-gray-800">Sin impuestos</span>
									</div>						
									<div class="flex flex-grow-1">
										<div class="text-right pr-3 w-full">
											<h:outputText value="#{notaDebitoFrmCtrl.notDebitoSelected.totalsinimpuestos}" styleClass="fs-14 text-black font-light">
							   					<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
							   				</h:outputText>
										</div>
									</div>				
								</div>
								<div class="flex mt-1 border-bottom-1 border-blue-100 py-2 align-items-end">
									<div class="flex flex-grow-1 fs-11">
										<i class="fa fa-angle-right mr-1 font-bold"></i>
										<span class="text-gray-800 mr-1">Seleccionar I.V.A.</span>
									</div>						
									<div class="flex flex-grow-1">
										<div class="text-right pr-3 w-full">
											<p:selectOneMenu id="somNdIva"
												value="#{notaDebitoFrmCtrl.totalimpuesto.iva}"
												converter="omnifaces.SelectItemsConverter"
												required="true"
												requiredMessage="Requerido"
												styleClass="w-full text-right">
												<f:selectItem itemLabel="Seleccionar..." itemValue="#{null}"/>	
												<f:selectItems value="#{notaDebitoFrmCtrl.ivaList}" var="iva"
													itemLabel="#{iva.porcentaje}" itemValue="#{iva}" />
												
												<p:ajax event="change" listener="#{notaDebitoFrmCtrl.calcularIvaAction()}" update="@form:oupNcTotal"  process="@this @form:oupNcTotal"/>
												
											</p:selectOneMenu>
											<p:message for="somNdIva" styleClass="block"/>
										</div>
									</div>				
								</div>
								<div class="flex mt-1 border-bottom-1 border-blue-100 py-2 align-items-end">
									<div class="flex flex-grow-1 fs-11">
										<i class="fa fa-angle-right mr-1 font-bold"></i>
										<span class="text-gray-800 mr-1">I.V.A.</span>
									</div>						
									<div class="flex flex-grow-1">
										<div class="text-right pr-3 w-full">
											<h:outputText value="#{notaDebitoFrmCtrl.notDebitoSelected.totaliva}" styleClass="fs-14 text-black font-light">
							   					<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
							   				</h:outputText>
										</div>
									</div>				
								</div>
									
							</div>
						</div>
					</div>
					<div class="col-12 md:col-5 align-self-center text-center py-2">
						<h:outputText value="#{notaDebitoFrmCtrl.notDebitoSelected.totalconimpuestos}" styleClass="fs-25 text-blue-600 font-bold inline">
							<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
						</h:outputText>
						<span class="inline fs-11 font-bold mr-1">TOTAL</span>
					</div>
					
					<div class="col-12 md:col-7">
						<div class="grid justify-content-end">
							<div class="col-12 md:col-6">
								<p:commandLink action="#{pagoCompCtrl.loadPantalla()}" 
									process="@this" 
									disabled="#{notaDebitoFrmCtrl.notDebitoSelected.totalpagar.doubleValue()==0 or notaDebitoFrmCtrl.notDebitoSelected.cliente==null}">
		    				
				    				<f:setPropertyActionListener value="NOTA_DEBITO" target="#{pagoCompCtrl.callModule}"/>
				    				<f:setPropertyActionListener value="#{notaDebitoFrmCtrl}" target="#{pagoCompCtrl.notaDebitoFrmCtrl}"/>
				    				<f:setPropertyActionListener value="#{notaDebitoFrmCtrl.notDebitoSelected}" target="#{pagoCompCtrl.cabeceraSelected}"/>
				    				<f:setPropertyActionListener value="#{notaDebitoFrmCtrl.pagoList}" target="#{pagoCompCtrl.pagoList}"/>
				    				<f:setPropertyActionListener value="formMain" target="#{pagoCompCtrl.callForm}"/>
				    				<f:setPropertyActionListener value=":formMain:oupNcTotal" target="#{pagoCompCtrl.updateView}"/>
				    				
				    				<div class="flex align-items-stretch #{notaDebitoFrmCtrl.notDebitoSelected.totalpagar.doubleValue()==0 or notaDebitoFrmCtrl.notDebitoSelected.cliente==null?'bg-gray-300':'bg-green-500'} border-1 border-green-500 text-white border-round" style="height: 100%;">
						    			<div class="flex align-items-center justify-content-center w-full">
						    				<div class="flex flex-inline">
						    					<div class="flex flex-inline gap-2 align-items-center">
						    					<i class="fa-solid fa-money-check-dollar fs-35"></i>
					    						<span class="fs-16 text-white font-medium">Pagar</span>
						    				</div>
						    				</div>
						    			</div>
						    		</div>
				    			</p:commandLink>
							</div>
						</div>
					</div>
					<div class="col-12 md:col-5 align-self-center text-center py-2">
						<div class="grid grid-nogutter">						
							<div class="col-12 align-self-center">
								<h:outputText value="#{notaDebitoFrmCtrl.totalPago}" styleClass="fs-25 text-black font-bold inline">
									<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
								</h:outputText>
								<span class="inline fs-11 font-bold mr-1">PAGO</span>
							</div>
						</div>
					</div>
					
				</div>
			</p:outputPanel>
	</div>
	
</ui:composition>
