<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:o="http://omnifaces.org/ui"
				xmlns:of="http://omnifaces.org/functions">
	
	<style type="text/css">
		
		.pagosDT .ui-datatable-scrollable-body{
			min-height: 15vh !important;
			max-height: 25vh !important;
		}
		
		.otrosPagosDT .ui-datatable-scrollable-body{
			min-height: 5vh !important;
			max-height: 10vh !important;
		}
		
		.heightFrmPagos{
			height: calc(100vh - 300px)!important;
		}
		
	</style>
	
	<p:dialog 
		header="Pagos" 
		widgetVar="dlgPagosForm" 
		modal="true" 
		responsive="true" 
		width="99%"
		style="max-width:900px;" 
		closeOnEscape="true" 
		styleClass="modalResponsivo" >
		
		<h:form id="formPagos">
		
			<!-- OPCIONES -->
			
			<div class="tool-bar">
				<i class="fa-solid fa-ellipsis-vertical"></i>
				<p:commandButton id="cmdCCRefrescar"
					value="Refrescar" 
					icon="fa fa-repeat fs-12" 
					styleClass="ui-button-outlined min-width-100 fs-12" 
					action="#{pagoCtrl.refrescarPagosForm()}" 
					process="@this" 
					update="@form" 
					/>
					
				<p:commandButton id="cmdCCGuardar"
					value="Guardar" 
					icon="fa fa-floppy-disk fs-12" 
					action="#{pagoCtrl.guardar()}" 
					update="@form :formMain" 
					styleClass="ui-button-success min-width-100 fs-12"/>
					
				<p:commandButton id="cmdCCCerrar"
					value="Cerrar" 
					icon="fa fa-sign-out fs-12" 
					styleClass="ui-button-outlined ui-button-secondary min-width-100 fs-12" 
					onclick="PF('dlgPagosForm').hide()" immediate="true"  
					/>
			</div>
			
			<div class="formgroup-inline">
				
			</div>
			
			<!-- Mensajes -->
			<p:messages id="msgFormPagos" rendered="#{not facesContext.validationFailed}" showSummary="true" showDetail="true" for="formPagos"
				closable="true" >
				<p:autoUpdate></p:autoUpdate>
			</p:messages>
			
			<!--  wraper del formulario para responsive -->
			
			<div class="w-full overflow-auto heightFrmCajaChica contenedorFormulario mt-2 pr-1 ui-fluid fs-12">
				
				<div style="width: 99.5%!important;">
					
					<span class="text-2xl text-gray-900 my-1 block">Valor a pagar</span>
					<div class="flex justify-content-center gap-2 align-items-center">
						<div class="flex flex-column gap-1 align-items-center">
							<h:outputText value="#{pagoCtrl.valorPagar}" styleClass="fs-14 text-gray-800 fw-5">
								<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
							</h:outputText>
							<div class="flex gap-1 fs-12 text-gray-600 align-items-baseline">
								Valor a <span class="fs-14 fw-5 text-gray-900">pagar</span>
							</div>
						</div>
						
						<p:commandLink action="#{porPagarCtrl.cargar()}" 
							rendered="#{pagoCtrl.callModule=='CUENTAS_COBRAR'}" 
							styleClass="flex px-3" 
							style="border-right: 1px solid #adb5bd;">
							<i class="fa fa-edit fs-20"></i>
							<f:setPropertyActionListener value="MAIN_POR_COBRAR" target="#{porPagarCtrl.callModule}"/>
							<f:setPropertyActionListener value="#{pagoCtrl}" target="#{porPagarCtrl.pagoCtrl}"/>
							<f:setPropertyActionListener value="#{pagoCtrl.idComprobante}" target="#{porPagarCtrl.idCabeceraSelected}"/>
							<f:setPropertyActionListener value="#{pagoCtrl.cuentaCobrarCtrl}" target="#{porPagarCtrl.cuentaCobrarCtrl}"/>
							<f:setPropertyActionListener value="formPagos" target="#{porPagarCtrl.callForm}"/>
							<f:setPropertyActionListener value="formPagos" target="#{porPagarCtrl.viewUpdate}"/>
						</p:commandLink>
						
						<p:commandLink action="#{porPagarCtrl.cargar()}" 
							rendered="#{pagoCtrl.callModule=='CUENTAS_PAGAR'}" 
							styleClass="flex px-3" 
							style="border-right: 1px solid #adb5bd;">
							<i class="fa fa-edit fs-20"></i>
							<f:setPropertyActionListener value="MAIN_POR_PAGAR" target="#{porPagarCtrl.callModule}"/>
							<f:setPropertyActionListener value="#{pagoCtrl}" target="#{porPagarCtrl.pagoCtrl}"/>
							<f:setPropertyActionListener value="#{pagoCtrl.idComprobante}" target="#{porPagarCtrl.idAdquisicionSelected}"/>
							<f:setPropertyActionListener value="#{pagoCtrl.cuentaPagarCtrl}" target="#{porPagarCtrl.cuentaPagarCtrl}"/>
							<f:setPropertyActionListener value="formPagos" target="#{porPagarCtrl.callForm}"/>
							<f:setPropertyActionListener value="formPagos" target="#{porPagarCtrl.viewUpdate}"/>
						</p:commandLink>
						
						<div class="flex flex-column gap-1 align-items-center pl-3">
							<h:outputText value="#{pagoCtrl.totalAdeudado}" styleClass="fs-14 #{cuentaCobrarCtrl.totalVencido > 0 ? 'fw-5 text-pink-400':''}">
								<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
							</h:outputText>
							<div class="flex gap-1 fs-12 text-gray-600 align-items-baseline">
								Saldo <span class="fs-14 fw-5 text-gray-900">pendiente</span>
							</div>
						</div>
					</div>
					
					<span class="text-2xl text-gray-900 my-1 block">Otros pagos</span>
					<p:dataTable id="otrosPagosDT"
	        			scrollable="true"
	        			value="#{pagoCtrl.pagoOtrosList}"
	        			var="p"
	        			emptyMessage="#{msg['mensaje.noexistenDatos']}"
						styleClass="otrosPagosDT fs-11"  
						rowKey="#{p.idpago}">
						
						<p:column headerText="Tipo pago" style="width:50px;">
							<h:outputText value="#{p.tipopago.nombre}" />
						</p:column>
						
						<p:column headerText="Valor" style="width:40px;" styleClass="text-center">
							<div class="flex justify-content-end">
								<h:outputText value="#{p.total}" styleClass="text-gray-900">
									<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
								</h:outputText>
							</div>
						</p:column>
						
						<p:column headerText="Importe" style="width:40px;" styleClass="text-center">
							<div class="flex justify-content-end">
								<h:outputText value="#{p.valorentrega}" styleClass="#{p.valorentrega.doubleValue()>0.0?' text-green-900':' opacity-60'}">
									<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
								</h:outputText>
							</div>
						</p:column>
						
						<p:column headerText="cambio" style="width:40px;" styleClass="text-center">
							<div class="flex justify-content-end">
								<h:outputText value="#{p.cambio}" styleClass="#{p.cambio>0.0?' text-gray-900':' opacity-60'}">
									<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
								</h:outputText>
							</div>
						</p:column>
						
						<p:column headerText="Banco" style="width:80px;">
							<h:outputText value="#{p.nombrebanco}" >
							</h:outputText>
						</p:column>
						
						<p:column headerText="Documento" style="width:80px;">						
							<h:outputText value="#{p.numerodocumento}" >
							</h:outputText>
						</p:column>
					</p:dataTable>
					
					<span class="text-2xl text-gray-900 my-1 block">Crédito</span>
					<div class="tool-bar">
						<i class="fa-solid fa-ellipsis-vertical"></i>
						<p:commandButton
							value="Agregar" icon="fa fa-plus fs-13" 
							action="#{pagoCtrl.nuevoPago()}" 
							styleClass="ui-button-outlined fs-13 "
							style="max-width:100px;"
						/>
					</div>
					<p:dataTable id="pagosDT"
	        			scrollable="true"
	        			value="#{pagoCtrl.pagoList}"
	        			var="f"
	        			emptyMessage="#{msg['mensaje.noexistenDatos']}"
						styleClass="pagosDT mt-1 fs-12"  
						rowKey="#{f.idpago}">
						
						<p:column headerText="Opc" style="width:20px;">
							
							<div class="flex justify-content-start">
								<p:commandLink action="#{pagoCtrl.eliminarCredito()}" 
									process="@this :formPagos:pagosDT" 
									update=":formPagos">
									<i class="fa fa-trash-o fs-14 text-gray-900"></i>
									<p:confirm header="#{msg['label.confirmacion']}" message="#{msg['mensaje.confimacion']}" icon="fa fw-3x fa-exclamation-triangle" />
									<f:setPropertyActionListener value="#{f}" target="#{pagoCtrl.pagoSelected}"/>
								</p:commandLink>
								<p:commandLink process="@this" 
									update=":formPagoRegistro" 
									oncomplete="PF('dlgFormPago').show();">
									<i class="fa fa-edit fs-14 text-gray-900"></i>
									<f:setPropertyActionListener value="#{f}" target="#{pagoCtrl.pagoSelected}"/>
								</p:commandLink>
							</div>
							
						</p:column>
						
						<p:column headerText="Fecha de pago" style="width:80px;">
							<h:outputText value="#{f.fechapago}" styleClass="fs-10 #{pagoCtrl.isPagoVencimiento(f) ? 'ui-tag ui-widget ui-tag-danger' : ''}">
								<f:convertDateTime pattern="dd/MM/yyyy"/>
							</h:outputText>
						</p:column>
						
						<p:column headerText="Plazo" style="width:40px;" styleClass="text-center">
							<div class="flex justify-content-end">
								<h:outputText value="#{f.plazo}" >
									<f:convertNumber pattern="#{appSessionCtrl.formatoInteger}"/>
								</h:outputText>
							</div>
						</p:column>
						
						<p:column headerText="Valor" style="width:80px;" styleClass="text-center">
							<div class="flex justify-content-end">
								<h:outputText value="#{f.total}" styleClass="text-gray-800 fw-5">
									<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
								</h:outputText>
							</div>
						</p:column>
						
						<p:column headerText="" style="width:25px;" >
							<p:commandLink update="@form" 
								action="#{pagoCtrl.aplicarAbonoAction()}"
								styleClass="flex justify-content-center"
								title="Pagar todo">
								<i class="fa-solid fa-circle-chevron-right fs-16"></i>
								<f:setPropertyActionListener value="#{f.total}" target="#{f.valorpago}"/>
							</p:commandLink>
						</p:column>
						
						<p:column headerText="Pago" style="width:70px;">
							
							<p:inputNumber id="insDetpagValPago" value="#{f.valorpago}" 
                                minValue="0" maxValue="#{f.total}" required="true">
								<p:ajax listener="#{pagoCtrl.aplicarAbonoAction()}" update="@form" process="@this :formPagos:pagosDT"/>
                            </p:inputNumber>
                            
						</p:column>
						
						<p:column headerText="NOTAS" style="width:150px;">
							
							<p:inputTextarea value="#{f.notas}" maxlength="500" rows="1" style="padding:0.2em !important;max-height:66px!important;">
							</p:inputTextarea>
							
						</p:column>
						
					</p:dataTable>
					
					<div class="grid">
						
						<div class="col-12 md:col-6 align-self-center">
							
						</div>
						
						<div class="col-12 md:col-6">							
							
							<div class="grid grid-nogutter justify-content-between">
								<div class="col-8 py-2">
									<div class="w-full">
										<span class="fs-10 mr-1 text-gray-900">TOTAL</span>
										<span class="fs-14 text-blue-600 font-medium">RESUMEN</span>
									</div>
								</div>
								<div class="col-1 text-center align-self-center">
									<i class="fa fa-angle-down fs-14"></i>
								</div>
								<div class="col-12 mt-1">
									
									<div class="flex mt-1 border-bottom-1 border-gray-100 py-2">
										<div class="flex flex-grow-1 fs-11 align-items-center">
											<i class="fa fa-angle-right mr-1 font-bold"></i>
											<span class="text-gray-800"><h:outputText value="Otros pagos" /></span>
										</div>						
										<div class="flex flex-grow-1 fs-10 ">
											<div class="text-right pr-3 w-full">
												<h:outputText value="#{pagoCtrl.totalOtrosPago}" styleClass="fs-14 text-gray-900">
								   					<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
								   				</h:outputText>
											</div>
										</div>				
									</div>
									
									<div class="flex mt-1 border-bottom-1 border-gray-100 py-2">
										<div class="flex flex-grow-1 fs-11 align-items-center">
											<i class="fa fa-angle-right mr-1 font-bold"></i>
											<span class="text-gray-800"><h:outputText value="Adeudado" /></span>
										</div>						
										<div class="flex flex-grow-1">
											<div class="text-right pr-3 w-full">
												<h:outputText value="#{pagoCtrl.totalAdeudado}" styleClass="fs-14 text-gray-900">
								   					<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
								   				</h:outputText>
											</div>
										</div>				
									</div>
									
									<div class="flex mt-1 border-bottom-1 border-gray-100 py-2">
										<div class="flex flex-grow-1 fs-11 align-items-center">
											<i class="fa fa-angle-right mr-1 font-bold"></i>
											<span class="text-gray-800"><h:outputText value="Pagos crédito" /></span>
										</div>						
										<div class="flex flex-grow-1">
											<div class="text-right pr-3 w-full">
												<h:outputText value="#{pagoCtrl.totalAbono}" styleClass="fs-14 text-gray-900">
								   					<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
								   				</h:outputText>
											</div>
										</div>				
									</div>
									
									<div class="flex mt-1 border-bottom-1 border-gray-100 py-2">
										<div class="flex flex-grow-1 fs-11 align-items-center">
											<i class="fa fa-angle-right mr-1 font-bold"></i>
											<span class="text-gray-800"><h:outputText value="Saldo" /></span>
										</div>						
										<div class="flex flex-grow-1">
											<div class="text-right pr-3 w-full">
												<h:outputText value="#{pagoCtrl.totalAdeudado}" styleClass="fs-14 text-gray-900">
								   					<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
								   				</h:outputText>
											</div>
										</div>				
									</div>
								</div>
							</div>
							
						</div>
						
					</div><!-- Totales -->
					
				</div>
				
			</div>
			
		</h:form>
		
   </p:dialog>  
   
</ui:composition>
