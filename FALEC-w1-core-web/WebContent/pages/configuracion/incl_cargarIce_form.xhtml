<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:o="http://omnifaces.org/ui"
				xmlns:of="http://omnifaces.org/functions">
	
	<style type="text/css">
		
		.heightFrmImportIce {
				/* height: 200px; */
		}
		.divMensaje{
			margin:0.5em !important;
			padding:1em !important;
			background-color: rgba(240, 243, 244,0.5); 
			border: 1px solid #D0D3D4;
			width: 100%;
		}
		
		.divOpciones{
			margin:0.5em !important;
			padding:1em !important;			
		}
		
	</style>
	
	<p:dialog header="#{msg['label.importarcatalogoice']}" widgetVar="dlgImportIce" modal="true" responsive="true" width="90%" closeOnEscape="true" styleClass="modalResponsivo">
		
		<h:form id="frmImportIce">
			
			<!-- OPCIONES -->
			
			<div class="p-grid toolBarPopUp" >
				
				<div class="p-col-12 p-md-6" style="text-align:left;">					
					
					<p:commandButton id="cmdCerrarImportIce"
						value="CERRAR" icon="fa fa-close" styleClass="secondary-button" 
						onclick="PF('dlgImportIce').hide()" immediate="true"  
						/>
					
				</div>
				
			</div>
			
			<p:messages rendered="#{not facesContext.validationFailed}" showSummary="true" showDetail="true" for="frmImportIce"
				closable="true" >
				<p:autoUpdate></p:autoUpdate>
			</p:messages>
			
			<!--  wraper del formulario para responsive -->
			
			<div class="form-ui Wid100 OvYScroll heightFrmImportIce contenedorFormulario">
				
				<div class="p-grid p-justify-center">
					<div class="p-col-12 p-md-8">
						<div class="divMensaje">
							<h2 style="margin: 0px;">Instrucciones</h2>
							<ol>
								<li>Llenar los datos con el formato adjunto :
									<p:commandButton ajax="false" onclick="PrimeFaces.monitorDownload(start, stop);" value="Descargar" icon="fa fa-download">
										<p:fileDownload value="#{iceCtrl.plantillaImportarIce}" />
									</p:commandButton>
									
								</li>
								<li>Los datos se deben completar desde la fila <strong class="Fs16" style="color:red;">3</strong> de la 1era hoja del libro de excel.</li>
								<li>Tomar en consideración que los datos ingresados son los proporcionados por el SRI:
								</li>
								<li>Seleccionar el archivo a importar.</li>
								<li>El sistema informará si no existe novedades en la importación, en caso de existir novedades en el mismo archivo seleccionado se indicará las novedades existentes.</li>
							</ol>
						</div>
						
						<div class="p-col-12">
							
							<div class="p-grid">
								<div class="p-col-12 p-md-4">
									<p:fileUpload id="filUImportIce"
										listener="#{iceCtrl.handleUpload_Ice}"
										allowTypes="/(\.|\/)(xls)$/"
										invalidFileMessage="SOLO FORMATOS [.xls]" 
										required="true"
										requiredMessage="REQUERIDO" 
										label="Seleccionar ..." 
										sizeLimit="25242880"
										invalidSizeMessage="#{msg['file.size']} 2MB" 
										mode="advanced" 
										dragDropSupport="true" 
										auto="true"
										update="@form"
										previewWidth="0"
										styleClass="Wid100">
									</p:fileUpload>
									<p:commandButton id="cmdImportIce"
										value="Importar Ice" icon="fa fa-floppy-o" styleClass="secondary-button Wid100"
										action="#{iceCtrl.importarIce()}"  
										update="@form, formMain"
										disabled="#{iceCtrl.fileIces==null}"
									/>
								</div>
								<div class="p-col-12 p-md-8">
									<div class="p-grid p-justify-center">
										<div class="p-col-12 p-md-4">
											<strong>Archivo Seleccionado :</strong>
										</div>
										<div class="p-col-12 p-md-8">
											<h:outputText value="#{iceCtrl.nombreFileIce}" />
										</div>
										<div class="p-col-12 p-md-4">
											<strong>Resultado :</strong>
										</div>
										<div class="p-col-12 p-md-8">
											<f:subview rendered="#{iceCtrl.renderResultadoImportIce and not iceCtrl.existeNovedadesIce}">
												<h4>Los datos se cargaron correctamente y no existen novedades.</h4>
											</f:subview>
											
											<f:subview rendered="#{iceCtrl.renderResultadoImportIce and iceCtrl.existeNovedadesIce}">
												<h4 style="color:red;">Existen novedades</h4>
												<p>Debe descargar el archivo, y cada fila de color rojo, al final de la fila en la columna 24 está descrita la novedad.</p>
												
												<p:commandButton id="cmdImportICeNovedades"
													value="Archivo Novedades" icon="fa fa-download" styleClass="secondary-button"
													ajax="false" onclick="PrimeFaces.monitorDownload(start, stop);" disabled="#{iceCtrl.fileIces==null}">
													<p:fileDownload value="#{iceCtrl.plantillaImportarIceNovedades}" />
												</p:commandButton>
												
											</f:subview>
											
										</div>
									</div>
								</div>
							</div>
						</div>
						
					</div>
				</div>		
					
			</div>
			
		</h:form>
		
   </p:dialog>  
    

</ui:composition>
