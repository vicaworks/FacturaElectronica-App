<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:o="http://omnifaces.org/ui"
				xmlns:of="http://omnifaces.org/functions"
                template="/WEB-INF/template/template.xhtml">

    <ui:define name="title">Inventario</ui:define>
    
    <ui:define name="head">
        <style type="text/css">
			
			.inventarioDT .ui-datatable-scrollable-body{
				min-height: 30vh !important;
				height: calc(100vh - 405px)!important;
			}
			
			.ui-calendar .ui-inputfield{
				width: 100% !important;
			}
			
			body .ui-datatable .ui-datatable-data > tr > td {
				padding: 0.3em; 
				border: 0 none;
				vertical-align: top;
			}
			
			.p-col-1, .p-col-2, .p-col-3, .p-col-4, .p-col-5, .p-col-6, .p-col-7, .p-col-8, .p-col-9, .p-col-10, .p-col-11, .p-col-12 {
				padding: 0.2em 0.5em !important;
			}
			
			.cardTitle{
				padding:0.5em 0px;
				font-size: 18px !important;
			}
			
			
			body .ui-fileupload .ui-fileupload-buttonbar {
			 border: none;
			 padding: 0px !important;
			}	
			
			body .ui-fileupload .ui-fileupload-content {
				border: none;
				padding: 0px;
				border-top: 0 none;
				line-height: 1.5;
			}
			
			body .ui-fileupload .ui-fileupload-buttonbar .ui-button {
				width: 100%;
			}
			
			@media screen and (max-width: 40em){
					.ui-fileupload-buttonbar .ui-button .ui-button-text {
					display: block !important;
				}
			}
			
			
        </style>
    </ui:define>

    <ui:define name="content">
    	
    	<!-- CONSTANTES -->
    	<o:importConstants type="com.vcw.falecpv.core.constante.EstadoRegistroEnum" var="EstadoRegistroEnum" />
    	
    	<p:breadCrumb>
		    <p:menuitem url="#{request.contextPath}/pages/main.jsf" />
		    <p:menuitem value="Productos" url="#{request.contextPath}/pages/productos/producto.jsf" />
		    <p:menuitem value="Kardex producto" url="#{request.contextPath}/pages/productos/kdx/kardexProducto.jsf"/>
		    <p:menuitem value="Inventario" url="#{request.contextPath}/pages/productos/inventario.jsf"/>
		</p:breadCrumb>
		
		<!-- OPCIONES -->
	    <h:form id="formMain">
	    	
	    	<div class="card card-w-title">
	    	
	    		<div class="p-grid p-align-center">
	    			<div class="p-col-12 p-md-6">
						<h3 class="cardTitle"><i class="fa fa-arrow-circle-right"/> Productos m√°s Vendidos</h3>
	    			</div>
	    			<div class="p-col-12 p-md-6 cmb_establecimiento" style="text-align: right;">
	                
		                <p:selectOneMenu id="somEstablecimientoMain"
							value="#{inventarioCtrl.establecimientoMain}"
							converter="omnifaces.SelectItemsConverter"
							styleClass="cmb_establecimiento_wrapper"
							disabled="#{not inventarioCtrl.habilitarEstablecimientoMain}">
							
							<f:selectItems value="#{inventarioCtrl.establecimientoMainList}" var="st"
								itemLabel="#{st.nombrecomercial.concat(' - ').concat(appSessionCtrl.formatoCadena(st.codigoestablecimiento,3,'0'))}" itemValue="#{st}" />
							
							<p:ajax event="valueChange" listener="#{inventarioCtrl.refrescar()}" update="@form"/> 
								
						</p:selectOneMenu>
		                
		                
	        		</div>
	    		</div>
				
		   		<div class="EmptyBox5"/>
	    		
	    		<div class="p-grid p-justify-center p-align-top vertical-container">
	    			
	    			<div class="p-col-12 p-md-8">
	    				
	    				<div class="p-grid">
	    					
	    					<div class="p-col-12">
	    						<div class="EmptyBox5"/>
	    						<h:outputText value="BUSCAR *" styleClass="cpoRequerido Wid100"/>
	    						<h:outputText value=" [Selecionar una de las opciones de busqueda.]" styleClass="color:gray;" style="Fs10"/>
		    					<div class="EmptyBox5"/>
	    						<div class="EmptyBox5"/>
	    						<p:selectOneMenu id="somInvOpcionBusqueda"
											value="#{inventarioCtrl.opcionBusqueda}"
											required="true"
											requiredMessage="REQUERIDO"
											styleClass="Wid100">
											
									<f:selectItem itemLabel="TODO EL INVENTARIO"
											itemValue="INVENTARIO"/>
									
									<f:selectItem itemLabel="STOCK MAYOR A 0"
											itemValue="STOCKMAYORZERO"/>
											
									<f:selectItem itemLabel="STOCK MENOR O IGUAL"
											itemValue="STOCKMENORIGUAL"/>
											
									<f:selectItem itemLabel="FECHA DE CADUCIDAD MENOR O IGUAL"
											itemValue="FECHACADUCIDAD"/>
									
									<f:selectItem itemLabel="POR PRODUCTO"
											itemValue="PRODUCTO"/>
									
									<f:selectItem itemLabel="POR CODIGO PRODUCTO"
											itemValue="CODPRODUCTO"/>
									
									<f:selectItem itemLabel="POR #{msg['label.categoria']}"
											itemValue="CATEGORIA"/>
									
									<f:selectItem itemLabel="POR FABRICANTE"
											itemValue="FABRICANTE"/>
											
									<p:ajax event="change" update="@form" process="@this :formMain:somInvOpcionBusqueda"/>
								</p:selectOneMenu>	
								<p:message for="somInvOpcionBusqueda" />
	    					</div>
	    					
	    					<div class="p-col-12">
	    						
	    						<f:subview rendered="#{inventarioCtrl.opcionBusqueda == 'STOCKMENORIGUAL'}">

									<p:inputText id="intinvStock" value="#{inventarioCtrl.stock}"
										required="true" requiredMessage="REQUERIDO"
										styleClass="Wid100" maxlength="1000"
										placeholder="STOCK MENOR O IGUAL A ..."
										converterMessage="#{msg['converter.solonumeros']}" />
									<p:message for="intinvStock" />
	    							
	    						</f:subview>
	    						
	    						<f:subview rendered="#{inventarioCtrl.opcionBusqueda == 'FECHACADUCIDAD'}">
	    							
	    							<p:calendar id="claInvFechaCaducidad" value="#{inventarioCtrl.fechaCaducidad}"
										pattern="dd/MM/yyyy"
										locale="es" 
										requiredMessage="REQUERIDO" required="true" styleClass="Wid100">
									</p:calendar>
									<p:message for="claInvFechaCaducidad" style="padding:0em;"/>
	    							
	    						</f:subview>
	    						
	    						<f:subview rendered="#{inventarioCtrl.opcionBusqueda == 'PRODUCTO'}">
	    							
	    							<p:selectOneMenu id="somInvListaProducto"
											value="#{inventarioCtrl.productoFormSelected}"
											converter="omnifaces.SelectItemsConverter"
											required="true"
											requiredMessage="REQUERIDO"
											styleClass="Wid100"
											filter="true" filterMatchMode="contains">
										<f:selectItem itemLabel="Seleccionar Producto ... "
												itemValue="#{null}" value="#{null}" noSelectionOption="true" />
										<f:selectItems value="#{inventarioCtrl.productoFormList}" var="prof"
											itemLabel="#{prof.nombregenerico}" itemValue="#{prof}" />
										<!-- <p:ajax event="change" listener="#{kardexCtrl.cambioProducto}"></p:ajax> -->
									</p:selectOneMenu>
									<p:message for="somInvListaProducto" />
	    							
	    						</f:subview>
	    						
	    						<f:subview rendered="#{inventarioCtrl.opcionBusqueda == 'CODPRODUCTO'}">
	    							<p:inputText id="intInvCodProducto" value="#{inventarioCtrl.codProducto}"
										required="true" requiredMessage="REQUERIDO"
										styleClass="Wid100" maxlength="1000"
										placeholder="CODIGO DEL PRODUCTO .."/>
									<p:message for="intInvCodProducto" />
	    						</f:subview>
	    						
	    						<f:subview rendered="#{inventarioCtrl.opcionBusqueda == 'CATEGORIA'}">
	    						
	    							<p:selectOneMenu id="somInvListaCategoria"
											value="#{inventarioCtrl.categoriaSelected}"
											converter="omnifaces.SelectItemsConverter"
											required="true"
											requiredMessage="REQUERIDO"
											styleClass="Wid100"
											filter="true" filterMatchMode="contains">
										<f:selectItem itemLabel="Seleccionar Categoria ... "
												itemValue="#{null}" value="#{null}" noSelectionOption="true" />
										<f:selectItems value="#{inventarioCtrl.categoriaList}" var="c"
											itemLabel="#{c.categoria}" itemValue="#{c}" />
									</p:selectOneMenu>
									<p:message for="somInvListaCategoria" />
									
	    						</f:subview>
	    						
	    						<f:subview rendered="#{inventarioCtrl.opcionBusqueda == 'FABRICANTE'}">
	    							
	    							<p:selectOneMenu id="somInvListaFabricante"
											value="#{inventarioCtrl.fabricanteSelected}"
											converter="omnifaces.SelectItemsConverter"
											required="true"
											requiredMessage="REQUERIDO"
											styleClass="Wid100"
											filter="true" filterMatchMode="contains">
										<f:selectItem itemLabel="Seleccionar Fabricante ... "
												itemValue="#{null}" value="#{null}" noSelectionOption="true" />
										<f:selectItems value="#{inventarioCtrl.fabricanteList}" var="f"
											itemLabel="#{f.nombrecomercial}" itemValue="#{f}" />
									</p:selectOneMenu>
									<p:message for="somInvListaFabricante" />
	    							
	    						</f:subview>
	    						
	    					</div>
	    					
	    				</div>
	    				
	    				
	    			</div>
	    			
	    			<div class="p-col-12 p-md-4">
	    				<div class="EmptyBox5"/>
	    				<div class="EmptyBox5"/>
	    				<p:commandButton id="cmdInvRefrecar"
							value="CONSULTAR" icon="fa fa-search" 
							action="#{inventarioCtrl.refrescar()}" styleClass="secondary-button Wid100" update="@form"
						/>
						<div class="EmptyBox5"/>
						<p:commandButton id="cmdInvNuevoProducto"
							value="NUEVO PRODUCTO" icon="fa fa-plus" 
							action="#{productoCtrl.nuevo()}" styleClass="secondary-button Wid100" update="@form">
							<f:setPropertyActionListener value="#{inventarioCtrl.establecimientoMain}" target="#{productoCtrl.establecimientoMain}"/>
							<f:setPropertyActionListener value="INVENTARIO" target="#{productoCtrl.callModule}"/>
							<f:setPropertyActionListener value="formMain" target="#{productoCtrl.formModule}"/>
							<f:setPropertyActionListener value=":formMain" target="#{productoCtrl.viewUpdate}"/>
							<f:setPropertyActionListener value="#{inventarioCtrl}" target="#{productoCtrl.inventarioCtrl}"/>
						</p:commandButton>
						<div class="EmptyBox5"/>
						<p:commandButton  id="cmdExcel" 
										title="EXPORTAR"
										icon="fa fa-file-excel-o"
										ajax="false" onclick="PrimeFaces.monitorDownload(start,stop)"
										value="REPORTE"
										styleClass="secondary-button Wid100"
										disabled="#{empty inventarioCtrl.productoList}">
							<p:fileDownload value="#{inventarioCtrl.fileInventario}"/>
						</p:commandButton>
						
	    			</div>
	    			
	    		</div>
	    		
	    	</div>
	    	
	    	<!-- Mensajes -->
			<p:messages rendered="#{not facesContext.validationFailed}" showSummary="true" showDetail="true" for="formMain"
				closable="true" style="margin:0px !important;">
				<p:autoUpdate></p:autoUpdate>
			</p:messages>
			
			<div class="EmptyBox5"/>
			
			<div class="card card-w-title">
				
				<p:dataTable id="inventarioDT" var="i"
					value="#{inventarioCtrl.productoList}" scrollable="true"
					emptyMessage="#{msg['mensaje.noexistenDatos']}"
					styleClass="inventarioDT Fs11"  
					rowKey="#{i.idproducto}"
					paginator="true"
	                paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
	                currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
	                paginatorPosition="bottom"
	                rows="15"
					rowsPerPageTemplate="15,20,25,30,35,40">
					
					<p:column headerText="OPC" style="width:30px;" styleClass="TexAlCenter">
						
						<p:commandLink id="cmlDtInventario">
							<i class="fa fa-chevron-circle-down Fs18" style="color:#252529;"/>
						</p:commandLink>
						
						
						<p:menu overlay="true" trigger="cmlDtInventario" my="left top" at="left bottom">
							
							<p:menuitem value="Editar Producto" action="#{productoCtrl.editarProducto(i.idproducto)}" icon="fa fa-edit" >
								<f:setPropertyActionListener value="#{inventarioCtrl.establecimientoMain}" target="#{productoCtrl.establecimientoMain}"/>
								<f:setPropertyActionListener value="INVENTARIO" target="#{productoCtrl.callModule}"/>
								<f:setPropertyActionListener value="formMain" target="#{productoCtrl.formModule}"/>
								<f:setPropertyActionListener value=":formMain" target="#{productoCtrl.viewUpdate}"/>
								<f:setPropertyActionListener value="#{inventarioCtrl}" target="#{productoCtrl.inventarioCtrl}"/>
							</p:menuitem>
							<p:menuitem value="Entrada Inventario" action="#{kardexCtrl.nuevo()}" icon="fa fa-sign-in" >
								<f:setPropertyActionListener value="#{inventarioCtrl.establecimientoMain}" target="#{kardexCtrl.establecimientoMain}"/>
								<f:setPropertyActionListener value="#{i}" target="#{kardexCtrl.productoSelected}"/>
				            	<f:setPropertyActionListener value="#{i.codigoprincipal}" target="#{kardexCtrl.codProducto}"/>
				            	<f:setPropertyActionListener value="E" target="#{kardexCtrl.tipoRegistro}"/>
								<f:setPropertyActionListener value="INVENTARIO" target="#{kardexCtrl.callMOdule}"/>
								<f:setPropertyActionListener value=":formMain" target="#{kardexCtrl.updateView}"/>
								<f:setPropertyActionListener value="frmKardex" target="#{kardexCtrl.formView}"/>
								<f:setPropertyActionListener value="#{inventarioCtrl}" target="#{kardexCtrl.inventarioCtrl}"/>
							</p:menuitem>
							<p:menuitem value="Salida Inventario" action="#{kardexCtrl.nuevo()}" icon="fa fa-sign-out" >
								<f:setPropertyActionListener value="#{inventarioCtrl.establecimientoMain}" target="#{kardexCtrl.establecimientoMain}"/>
								<f:setPropertyActionListener value="#{i}" target="#{kardexCtrl.productoSelected}"/>
				            	<f:setPropertyActionListener value="#{i.codigoprincipal}" target="#{kardexCtrl.codProducto}"/>
				            	<f:setPropertyActionListener value="S" target="#{kardexCtrl.tipoRegistro}"/>
								<f:setPropertyActionListener value="INVENTARIO" target="#{kardexCtrl.callMOdule}"/>
								<f:setPropertyActionListener value=":formMain" target="#{kardexCtrl.updateView}"/>
								<f:setPropertyActionListener value="frmKardex" target="#{kardexCtrl.formView}"/>
								<f:setPropertyActionListener value="#{inventarioCtrl}" target="#{kardexCtrl.inventarioCtrl}"/>
							</p:menuitem>
						</p:menu>
						
					</p:column>
					
					<p:column headerText="ID" style="width:20px;">
						<h:outputText value="#{i.idproducto}" />
					</p:column>
					
					<p:column headerText="#{msg['label.codigo']}" style="width:30px;" filterBy="#{i.codigoprincipal}" filterMatchMode="contains">
						<h:outputText value="#{i.codigoprincipal}" />
					</p:column>
					
					<p:column headerText="NOMBRE" style="width:120px;"  filterBy="#{i.nombregenerico}" filterMatchMode="contains">
						<h:outputText value="#{i.nombregenerico}" />
					</p:column>
					
					<p:column headerText="FECHA VENCIMIENTO" style="width:60px;" styleClass="TexAlCenter" rendered="#{inventarioCtrl.opcionBusqueda=='FECHACADUCIDAD'}">
						<h:outputText value="#{i.fechavencimiento}" styleClass="#{i.fechavencimiento!=null?'markRed':''} ">
							<f:convertDateTime  pattern="dd/MM/yyyy"/>
						</h:outputText>
					</p:column>
					
					<p:column headerText="STOCK" style="width:30px;" styleClass="TexAlRight">
						<h:outputText value="#{i.stock}" styleClass="#{i.stock.doubleValue()==0.0?'markRed':'markGreen'}">
							<f:convertNumber  pattern="#{appSessionCtrl.formatoNumberDecimalOpcional}"/>
						</h:outputText>
					</p:column>
					
					<p:column headerText="COST. UNIT." style="width:30px;" styleClass="TexAlRight">
						<h:outputText value="#{i.preciounitario}" >
							<f:convertNumber  pattern="#{appSessionCtrl.formatoMoneda}"/>
						</h:outputText>
					</p:column>
					
					<p:column headerText="COST. TOTAL." style="width:30px;" styleClass="TexAlRight">
						<h:outputText value="#{i.costototal}" >
							<f:convertNumber  pattern="#{appSessionCtrl.formatoMoneda}"/>
						</h:outputText>
					</p:column>
					
					
				</p:dataTable>
				
				<div class="EmptyBox20"/>
				
			</div>
			
			
	    </h:form>
	    
	    <!-- Form Entrada -->
	    <ui:include src="kdx/incl_kardex_entrada_form.xhtml" />
	    
	    <!-- Form Salida -->
	    <ui:include src="kdx/incl_kardex_salida_form.xhtml" />
	    
	    <!-- Form Producto -->
	    <ui:include src="incl_producto_form.xhtml" />
	    
	    <!-- Form Fabricante -->
	    <ui:include src="incl_fabricante_form.xhtml" />
	    
	    <!-- Form Categoria -->
	    <ui:include src="incl_categoria_form.xhtml" />
        
    </ui:define>

</ui:composition>
