<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:o="http://omnifaces.org/ui"
				xmlns:of="http://omnifaces.org/functions">
	
	<style type="text/css">
		
		.heightFrmProducto{min-height: 310px!important;height: 310px!important;}
		
		.product-image-form {
				/* aspect-radio: 10 / 6; */
				max-width: 270px;
				max-height: 270px;
				object-fit: cover;
				object-position: center top;
				
		}
		
		@media screen and (max-height: 768px ) {
			.heightFrmProducto{min-height: 530px!important;}
			
		}		  
		
	</style>
	
	<p:dialog header="Producto" 
		widgetVar="dlgProducto" 
		modal="true" 
		responsive="true" 
		width="99%"
		style="max-width: 100rem" 
		closeOnEscape="true" 
		styleClass="modalResponsivo">
		
		<h:form id="frmProducto">
			
			<!-- OPCIONES -->
			<div class="tool-bar mb-2">
				<i class="fa-solid fa-ellipsis-vertical"></i>
				<p:commandButton id="cmdGuardarProductoForm"
					title="Guardar" 
					icon="fa-regular fa-floppy-disk fs-13" 
					value="Guardar" 
					action="#{productoCtrl.guardar()}" 
					styleClass="min-width-100 ui-button-success fs-13" 
					update="@form #{productoCtrl.viewUpdate}"/>
					
				<p:commandButton id="cmdNuevoProductoForm"
					title="Nuevo" 
					icon="fa-regular fa-plus fs-13" 
					value="Nuevo"
					action="#{productoCtrl.nuevoForm()}" 
					styleClass="min-width-100 ui-button-outlined fs-13" 
					update="@form" 
					process="@this"/>
					
							
				<p:commandButton id="cmdCerrarProductoForm"
					value="Cerrar" 
					styleClass="min-width-100 ui-button-secondary ui-button-outlined fs-13" 
					onclick="PF('dlgProducto').hide()" 
					immediate="true"  
					/>
			</div>
			
			<div class="field">	
				<label class="text-gray-800 fw-5">Buscar producto</label>
				<div class="ui-inputgroup">
					<p:selectOneMenu id="somFrmListaProducto"
									value="#{productoCtrl.productoFormSelected}"
									converter="omnifaces.SelectItemsConverter"
									required="false"
									requiredMessage="Requerido"
									styleClass="overflow-x-hidden"
									style="width: calc(100% - 6.5rem)"
									filter="true" filterMatchMode="contains">
						<f:selectItem itemLabel="Seleccionar producto ..."
								itemValue="#{null}" value="#{null}" noSelectionOption="true" />

						<f:selectItems value="#{productoCtrl.productoFormList}" var="prof"
							itemLabel="#{prof.nombregenerico}" itemValue="#{prof}" />
							
					</p:selectOneMenu>
					<p:commandButton id="cmdBuscarProductoForm"
						title="Buscar"
						value="Buscar" 
						icon="fa fa-search"
						action="#{productoCtrl.editarProductoForm()}" 
						styleClass="ui-button-outlined" 
						process="@this :frmProducto:somFrmListaProducto" 
						update="@form"/>
                </div>			
			</div>
			
			<p:messages rendered="#{not facesContext.validationFailed}" showSummary="true" showDetail="true" for="frmProducto"
				closable="true" >
				<p:autoUpdate></p:autoUpdate>
			</p:messages>
			
			<div class="fs-14 text-red-500 m-0 p-0">
				<o:messages for="frmProducto" message="Existen errores de validación. Por favor debe corregirlos." />
			</div>
			
			<div class="w-full overflow-auto contenedorFormulario heightFrmProducto">
			
				<p:tabView style="width: 99.5%!important;" id="tabProducto" activeIndex="">		            
		            <p:tab title="Datos Generales"  multiViewState="true" titleStyleClass="fs-14 fw-2">
		                
		                <div class="grid ui-fluid">
		                	<div class="col-12 md:col-6 md:pr-2">
		                		
		                		<div class="field">							
									<label class="text-gray-800 fw-5">Estado</label>
									<p:selectOneMenu id="somInvEstado" 
										value="#{productoCtrl.productoSelected.estado}" 
										disabled="#{productoCtrl.productoSelected.idproducto==null}">
						    			<f:selectItem itemLabel="Activo" itemValue="A" />
						    			<f:selectItem itemLabel="Inactivo" itemValue="I" />
						    			<f:selectItem itemLabel="Todos" itemValue="T" />
						    		</p:selectOneMenu>
							    </div>
							    
							    <div class="field">							
									<label class="text-gray-800 fw-5">Fabricante</label>
									<div class="flex gap-2 align-items-baseline">
										<p:selectOneMenu id="somFrmProductoFabricante"
											value="#{productoCtrl.productoSelected.fabricante}"
											converter="omnifaces.SelectItemsConverter"
											required="true"
											requiredMessage="REQUERIDO"
											styleClass="flex-1"
											filter="true" filterMatchMode="contains">
											<f:selectItem itemLabel="#{msg['label.seleccionar']} ..."
													itemValue="#{null}" value="#{null}" noSelectionOption="true" />
					
											<f:selectItems value="#{productoCtrl.fabricanteList}" var="fab"
												itemLabel="#{fab.nombrecomercial}" itemValue="#{fab}" />
										</p:selectOneMenu>
										<div class="flex gap-2 align-self-center justify-content-end" 
											style="flex: 0; align-items: stretch; flex-basis: 4rem;">
											<p:commandLink styleClass="text-gray-800"
												action="#{fabricanteCtrl.nuevo()}" 
												immediate="true"
												title="Nuevo">
												<i class="fa-solid fa-file fs-16"></i>												
												<f:setPropertyActionListener value="PRODUCTO" target="#{fabricanteCtrl.moduloCall}"/>
												<f:setPropertyActionListener value="#{productoCtrl}" target="#{fabricanteCtrl.productoCtrl}"/>
												<f:setPropertyActionListener value="frmProducto:tabProducto:somFrmProductoFabricante" target="#{fabricanteCtrl.updateView}"/>
											</p:commandLink>
											<p:commandLink styleClass="text-gray-800"
												action="#{fabricanteCtrl.editar()}" 
												partialSubmit="true"
												process="@this :frmProducto:tabProducto:somFrmProductoFabricante"
												update="@this :frmProducto:tabProducto:somFrmProductoFabricante"
												title="Editar">
												<i class="fa-solid fa-edit fs-16 fw-1"></i>												
												<f:setPropertyActionListener value="PRODUCTO" target="#{fabricanteCtrl.moduloCall}"/>
												<f:setPropertyActionListener value="#{productoCtrl.productoSelected.fabricante}" target="#{fabricanteCtrl.fabricanteSelected}"/>
												<f:setPropertyActionListener value="#{productoCtrl}" target="#{fabricanteCtrl.productoCtrl}"/>
												<f:setPropertyActionListener value="frmProducto:tabProducto:somFrmProductoFabricante" target="#{fabricanteCtrl.updateView}"/>
											</p:commandLink>
										</div>
									</div>
								</div>
								
								<div class="field">							
									<label class="text-gray-800 fw-5">Categoría</label>
									<div class="flex gap-2 align-items-baseline">
										<p:selectOneMenu id="somFrmProductoCategoria"
											value="#{productoCtrl.productoSelected.categoria}"
											converter="omnifaces.SelectItemsConverter"
											required="true"
											requiredMessage="REQUERIDO"
											styleClass="flex-1"
											filter="true" filterMatchMode="contains">
											<f:selectItem itemLabel="#{msg['label.seleccionar']} ..."
													itemValue="#{null}" value="#{null}" noSelectionOption="true" />
					
											<f:selectItems value="#{productoCtrl.categoriaList}" var="c"
												itemLabel="#{c.categoria}" itemValue="#{c}" />
										</p:selectOneMenu>
										<div class="flex gap-2 align-self-center justify-content-end" 
											style="flex: 0; align-items: stretch; flex-basis: 4rem;">
											<p:commandLink action="#{categoriaCtrl.nuevo()}" 
												immediate="true"
												styleClass="text-gray-800">
												<i class="fa-solid fa-file fs-16"></i>
												<f:setPropertyActionListener value="PRODUCTO" target="#{categoriaCtrl.moduloCall}"/>
												<f:setPropertyActionListener value="#{productoCtrl}" target="#{categoriaCtrl.productoCtrl}"/>
												<f:setPropertyActionListener value="frmProducto:somFrmProductoCategoria" target="#{categoriaCtrl.updateView}"/>
											</p:commandLink>
											<p:commandLink styleClass="text-gray-800"
												action="#{categoriaCtrl.editar()}" 
												partialSubmit="true"
												process="@this :frmProducto:tabProducto:somFrmProductoCategoria"
												update="@this :frmProducto:tabProducto:somFrmProductoCategoria"
												title="Editar">
												<i class="fa-solid fa-edit fs-16 fw-1"></i>												
												<f:setPropertyActionListener value="PRODUCTO" target="#{categoriaCtrl.moduloCall}"/>
												<f:setPropertyActionListener value="#{productoCtrl}" target="#{categoriaCtrl.productoCtrl}"/>
												<f:setPropertyActionListener value="#{productoCtrl.productoSelected.categoria}" target="#{categoriaCtrl.categoriaSelected}"/>
												<f:setPropertyActionListener value="frmProducto:somFrmProductoCategoria" target="#{categoriaCtrl.updateView}"/>
											</p:commandLink>
										</div>
									</div>
								</div>
								
								<div class="field">	
														
									<label class="text-gray-800 fw-5">Tipo de producto</label>
									<p:selectOneMenu id="somFrmProductoTipo"
										value="#{productoCtrl.productoSelected.tipoProducto}"
										converter="omnifaces.SelectItemsConverter"
										required="true"
										requiredMessage="Requerido"
										filter="true" filterMatchMode="contains">
										<f:selectItem itemLabel="#{msg['label.seleccionar']} ..."
												itemValue="#{null}" value="#{null}" noSelectionOption="true" />
				
										<f:selectItems value="#{productoCtrl.tipoProductoList}" var="tp"
											itemLabel="#{tp.nombre}" itemValue="#{tp}" />
										<p:ajax update=":frmProducto:tabProducto:tieneInventario"/>
									</p:selectOneMenu>
									
								</div>
								
								<div class="flex gap-2">	
									
									<div class="field flex-1">
										<label class="text-gray-800">Código interno</label>
										<p:inputText id="intCodigoInternoProducto" 
											value="#{productoCtrl.productoSelected.codigoauxiliar}" 
											required="false" 
											requiredMessage="Requerido" 
											maxlength="25"/>
									</div>					
									
									<div class="field flex-1">
										<label class="text-gray-800 fw-5">Código de barra</label>
										<p:inputText id="intCodigoBarraProducto" 
											value="#{productoCtrl.productoSelected.codigoprincipal}" 
											required="true" 
											requiredMessage="Requerido" 
											maxlength="25"/>
									</div>
									
								</div>
								
								<div class="field">
								
									<label class="text-gray-800 fw-5">Nombre del producto</label>
									<p:inputText id="intNombreProducto" 
										value="#{productoCtrl.productoSelected.nombre}" 
										required="true" 
										requiredMessage="Requerido"
										maxlength="300" 
										converter="omnifaces.ToUpperCaseConverter"/>
										
								</div>
								
								<div class="field">
								
									<label class="text-gray-800">Descripción del producto</label>
									<p:inputTextarea id="intDescripcionProducto" 
										value="#{productoCtrl.productoSelected.observacion}" 
										required="false" 
										requiredMessage="Requerido"
										maxlength="800" 
										converter="omnifaces.ToUpperCaseConverter" 
										rows="2"/>
									<small>Detalla las carecterísticas del producto</small>
										
								</div>
		                	
		                	</div>
		                	
		                	<div class="col-12 md:col-6 pr-1">
		                		<div class="flex gap-2">
			                		<div class="field flex-1">
									
										<label class="text-gray-800 fw-5">Cómo se vende</label>
										<p:selectOneMenu id="somFrmTipVentaProducto"
											value="#{productoCtrl.productoSelected.tipoventa}"
											required="true"
											requiredMessage="Requerido"
											filter="true" filterMatchMode="contains">
											<f:selectItem itemLabel="Por unidad"
													itemValue="#{1}"/>
											<f:selectItem itemLabel="A granel (Usa Decimales)"
													itemValue="#{2}"/>			
											<f:selectItem itemLabel="Por kit"
													itemValue="#{3}"/>
										</p:selectOneMenu>
										
									</div>
									<div class="field flex-1">
									
										<label class="text-gray-800 fw-5">Compra: <span class="fw-2">costo unitario</span></label>
										<p:inputText id="intPuProducto"
											value="#{productoCtrl.productoSelected.preciounitario}"
											required="true" 
											requiredMessage="Requerido"
											converterMessage="#{msg['converter.solonumeros']}" 
											validatorMessage="Valor >= 0"
											styleClass="text-right">
											<f:validateDoubleRange minimum="0"/>
										</p:inputText>									
									</div>
		                		</div>
								
								<p:outputPanel id="tieneInventario" styleClass="w-full">
									
									<div class="field ">
										<label class="text-gray-800 fw-5 flex gap-2 align-items-baseline">
											<span class="text-primary-600 fw-4 fs-12">Administrar inventario : </span>
											<span class="fs-12 text-gray-900 fw-2">
												Este producto 
												<span class="fw-5 #{productoCtrl.productoSelected.tipoProducto!=null and productoCtrl.productoSelected.tipoProducto.idtipoproducto=='1'?'text-primary-600':'text-gray-800'}">#{productoCtrl.productoSelected.tipoProducto!=null and productoCtrl.productoSelected.tipoProducto.idtipoproducto=='1'?'SI':'NO'}</span> utiliza inventario.</span>
										</label>
										
										<div class="flex gap-2 my-2">
											<div class="field flex-1">
												<label class="text-gray-800 fw-5">Stock actual</label>
								    			<span class="fs-18 fw-5 block text-right text-primary-600" style="margin-top: .5rem;">#{productoCtrl.productoSelected.stock}</span>												
											</div>
											<div class="field flex-1">
												<label class="text-gray-800 fw-5">Stock mínimo</label>
								    			<p:inputText id="intFrmProductoStockMin"
													value="#{productoCtrl.productoSelected.stockminimo}"
													required="true" 
													requiredMessage="Requerido"
													styleClass="fs-18 text-right" 
													converterMessage="#{msg['converter.solonumeros']}" 
													validatorMessage="Valor >= 0"
													disabled="#{productoCtrl.productoSelected.tipoProducto==null or productoCtrl.productoSelected.tipoProducto.idtipoproducto!='1'}">
													<f:validateDoubleRange minimum="0"/>
												</p:inputText>												
											</div>
											<div class="field flex-1">
												<label class="text-gray-800 fw-5">Stock máximo</label>
								    			<p:inputText id="intFrmProductoStockMax"
													value="#{productoCtrl.productoSelected.stockmaximo}"
													required="true" 
													requiredMessage="Reuqerido"
													styleClass="fs-18 text-right" 
													converterMessage="#{msg['converter.solonumeros']}" 
													validatorMessage="Valor >= 0"
													disabled="#{productoCtrl.productoSelected.tipoProducto==null or productoCtrl.productoSelected.tipoProducto.idtipoproducto!='1'}">
													<f:validateDoubleRange minimum="0"/>
												</p:inputText>												
											</div>
										</div>
									</div>
								
								</p:outputPanel>
								
								<div class="hidden md:block" style="margin-top: .7rem;"></div>
								<div class="flex gap-2">
									<div class="field flex-1">
										<label class="text-gray-800 fw-5">Iva %</label>
										<p:selectOneMenu id="somFrmIvaProducto"
											value="#{productoCtrl.productoSelected.iva}"
											converter="omnifaces.SelectItemsConverter"
											required="true"
											requiredMessage="Requerido"
											filter="true" filterMatchMode="contains">
											<f:selectItem itemLabel="#{msg['label.seleccionar']} ..."
													itemValue="#{null}" value="#{null}" noSelectionOption="true" />					
											<f:selectItems value="#{productoCtrl.ivaList}" var="iva"
												itemLabel="#{iva.porcentaje}" itemValue="#{iva}" />
										</p:selectOneMenu>
									</div>
									<div class="field flex-1">
										<label class="text-gray-800 fw-5">Ice %</label>
										<p:selectOneMenu id="somFrmIceProducto"
											value="#{productoCtrl.productoSelected.ice}"
											converter="omnifaces.SelectItemsConverter"
											required="true"
											requiredMessage="Requerido"
											filter="true" filterMatchMode="contains">
											<f:selectItem itemLabel="#{msg['label.seleccionar']} ..."
													itemValue="#{null}" value="#{null}" noSelectionOption="true" />
											<f:selectItems value="#{productoCtrl.iceList}" var="ice"
												itemLabel="#{ice.descripcion}" itemValue="#{ice}" />
										</p:selectOneMenu>
									</div>
								</div>
								
								<div class="flex gap-2">
									<div class="field flex-1">
										<label class="text-gray-800 fw-5">Precio de venta 1</label>
										<p:inputText id="intPreVenta1Producto"
											value="#{productoCtrl.productoSelected.preciouno}"
											required="true" 
											requiredMessage="Requerido"
											converterMessage="#{msg['converter.solonumeros']}" 
											validatorMessage="Valor >= 0"
											styleClass="fs-18 text-right">
											<f:validateDoubleRange minimum="0"/>
										</p:inputText>
										<small>Sin Iva</small>
									</div>
									<div class="field flex-1">
										<label class="text-gray-800">Precio de venta 2</label>
										<p:inputText id="intPreVenta2Producto"
											value="#{productoCtrl.productoSelected.preciodos}"
											required="true" 
											requiredMessage="Requerido"
											styleClass="fs-18 text-right"
											converterMessage="#{msg['converter.solonumeros']}" 
											validatorMessage="Valor >= 0">
											<f:validateDoubleRange minimum="0"/>
										</p:inputText>
										<small>Sin Iva</small>
									</div>
									<div class="field flex-1">
										<label class="text-gray-800">Precio de venta 3</label>
										<p:inputText id="intPreVenta3Producto"
											value="#{productoCtrl.productoSelected.preciotres}"
											required="true" 
											requiredMessage="REQUERIDO"
											styleClass="fs-18 text-right"
											converterMessage="#{msg['converter.solonumeros']}" 
											validatorMessage="Valor >= 0">
											<f:validateDoubleRange minimum="0"/>
										</p:inputText>
										<small>Sin Iva</small>
									</div>
								</div>
		                		
		                	</div>
		                	
		                	
		                </div>
		                
		                
		            </p:tab>
		            <p:tab title="Unidades de medida" titleStyleClass="fs-14">
		            	
		            	<div class="grid ui-fluid">
		                	<div class="col-12 md:col-6 md:pr-2">
		                		<div class="field">
									<label class="text-gray-800">Unidades x Caja / Embase</label>
									<p:inputText id="intUniCajaProducto"
										value="#{productoCtrl.productoSelected.unidadesporcajaofrasco}"
										required="true" 
										requiredMessage="Requerido"
										styleClass="text-right" 
										maxlength="10" 
										converterMessage="#{msg['converter.solonumeros']}" validatorMessage="Valor > 0">
										<f:validateDoubleRange minimum="0"/>									
									</p:inputText>
									<p:message styleClass="block m-0 p-0" for="intUniCajaProducto"/>	
								</div>
		                		
		                		<div class="field">
									<label class="text-gray-800">Unidades x Empaque</label>
									<p:inputText id="intUniEmpaqueProducto"
										value="#{productoCtrl.productoSelected.unidadesporpaquete}"
										required="true" 
										requiredMessage="Requerido" 
										styleClass="text-right"
										maxlength="10" 
										converterMessage="#{msg['converter.solonumeros']}" 
										validatorMessage="Valor > 0">
										<f:validateDoubleRange minimum="0"/>
									</p:inputText>
									<p:message styleClass="block m-0 p-0" for="intUniEmpaqueProducto"/>
								</div>
		                		
		                		<div class="field">
									<label class="text-gray-800">Unidad de medida</label>
									<p:inputText id="intUniMedidaProducto" 
										value="#{productoCtrl.productoSelected.medida}" 
										required="false" 
										requiredMessage="Requerido" 
										styleClass="text-right" 
										maxlength="10"/>
									<small>[kg, g, lt, etc]</small>
									<p:message styleClass="block m-0 p-0" for="intUniMedidaProducto"/>
								</div>
								
								<div class="field">
									<label class="text-gray-800">Conversión de medida</label>
									<p:inputText id="intUniConversionProducto"
										value="#{productoCtrl.productoSelected.conversionmedida}"
										required="true" 
										requiredMessage="Reuqerido" 
										styleClass="text-right"
										maxlength="11" 
										converterMessage="#{msg['converter.solonumeros']}" 
										validatorMessage="Valor > 0">
										<f:validateDoubleRange minimum="0"/>
									</p:inputText>
									<p:message styleClass="block m-0 p-0" for="intUniConversionProducto"/>
								</div>
		                		
		                	</div>
		                </div>
		            	    
		            </p:tab>
		            
		            <p:tab title="Imagen" titleStyleClass="fs-14">
		                <p:outputPanel id="gridProductoIMG" styleClass="grid justify-content-center">
		                	<div class="col-6 md:col-2">
		                		<div class="flex flex-column gap-2 text-center">
		                			<p:commandButton id="cmdLimpiarImagenProductoForm"
										value="Limpiar" icon="fa fa-eraser" 
										styleClass="ui-button-outlined flex-1"
										action="#{productoCtrl.limpiarImagen()}" 
										immediate="true"  
										update=":frmProducto:tabProducto:gridProductoIMG"
										disabled="#{productoCtrl.productoSelected.imagen==null}"
									/>
		                			<p:fileUpload id="fileUploadComponent"
										listener="#{productoCtrl.handleUpload}"
										allowTypes="/(\.|\/)(jpg|gif|jpe?g|png|tif)$/"
										invalidFileMessage="SOLO FORMATOS [png,jpg,svg,tif,gif]" 
										required="true"
										requiredMessage="REQUERIDO" 
										label="Seleccionar ..." 
										sizeLimit="25242880"
										invalidSizeMessage="#{msg['file.size']} 2MB" 
										mode="advanced" 
										dragDropSupport="true" 
										auto="true"
										update=":frmProducto:tabProducto:gridProductoIMG"
										previewWidth="0"
										styleClass="flex-1">
									</p:fileUpload>
		                		</div>
		                	</div>
		                	<div class="col-12 md:col-4">
		                		<div class="flex justify-content-center">
		                			
		                			<p:graphicImage value="#{productoCtrl.imageProducto}" 
		                				stream="false" 
		                				rendered="#{productoCtrl.productoSelected.imagen!=null}" 
		                				styleClass="product-image-form"/>
		                			
		                		</div>
		                	</div>
		                </p:outputPanel>
		            </p:tab>
				</p:tabView>
			
			</div>			
		</h:form>		
   </p:dialog>      

</ui:composition>
