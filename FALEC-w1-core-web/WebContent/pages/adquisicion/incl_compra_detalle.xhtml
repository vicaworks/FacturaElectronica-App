<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:o="http://omnifaces.org/ui"
				xmlns:of="http://omnifaces.org/functions">
	
	<style type="text/css">
		
		
		.ui-datascroller .ui-datascroller-content {/* min-height:500px!important; */height: calc(100vh - 325px);}
		
		.adquisicionDetDT .ui-inputnumber .ui-inputfield{height: 100%!important;text-align: center;font-size: 14px;width: 95px;max-width: 95px;}
		
	</style>
	
	<div class="card ">
		<p:dataScroller id="adquisicionDetDT" value="#{adquisicionFrmCtrl.adquisiciondetalleList}" var="d" chunkSize="10" mode="inline" styleClass="adquisicionDetDT" >
            <f:facet name="header">
            	<!-- <i class="fa fa-list mr-1"></i>
                Lista de Compras -->
                <div class="flex justify-content-between align-items-end">
                	<span class="text-gray-900 fs-12">Detalle</span>
                	<p:commandButton value="Agregar producto" 
                		styleClass="fs-12 min-width-80" 
                		icon="fa fa-plus fs-12"
                		process="@this :formMain:adquisicionDetDT"
						oncomplete="PrimeFaces.focus('frmListProducto:intListProBusqueda');"
						action="#{listaProductoCtrl.loadPantalla()}">
                		<f:setPropertyActionListener value="ADQUISICION" target="#{listaProductoCtrl.callModule}"/>
						<f:setPropertyActionListener value="NUEVO" target="#{listaProductoCtrl.accion}"/>
						<f:setPropertyActionListener value=":formMain:adquisicionDetDT :formMain:oupTotales :formMain:oupPagoDT :formMain:intRetRenta :formMain:intRetRentaPorcentaje :formMain:intRetIva :formMain:intRetIvaPorcentaje" target="#{listaProductoCtrl.viewUpdate}"/>
						<f:setPropertyActionListener value="formMain" target="#{listaProductoCtrl.formModule}"/>
						<f:setPropertyActionListener value="#{adquisicionFrmCtrl}" target="#{listaProductoCtrl.adquisicionFrmCtrl}"/>
						<f:setPropertyActionListener value="#{adquisicionFrmCtrl.establecimientoMain}" target="#{listaProductoCtrl.establecimientoMain}"/>
                	</p:commandButton>
                </div>
            </f:facet>
            
            <div class="grid border-bottom-1 border-blue-100 mb-1 pb-1">
            	<div class="col-12" >
            		<span class="text-gray-900 fs-12">#{d.descripcion}</span>
            		<div class="flex-inline gap-1">
            			<i class="fa fa-barcode fs-10"></i>
            			<span class="fs-10">#{d.producto!=null?d.producto.codigoprincipal:"-"} </span>
            		</div>
            	</div>
            	<div class="col-12">            		
            		<div class="flex flex-column md:flex-row">
            			<div class="flex-grow-1 md:flex-grow-0 flex w-auto md:w-4 flex-order-1 md:flex-order-0 align-self-end md:align-self-center gap-2 md:justify-content-center mt-1 md:mt-0">
            				
            				
            				<p:commandLink id="clkAdqEdit" 
            					title="Editar" 
            					process="@this :formMain:adquisicionDetDT" 
            					disabled="#{adquisicionFrmCtrl.adquisicionSelected.estado!=ComprobanteEstadoEnum.REGISTRADO}" 
            					styleClass="p-3 det-item-hover" 
            					style="border-radius:100%; border: 1px solid #b3d7ff;width:4.1rem;height:4.1rem;"
            					action="#{listaProductoCtrl.loadPantalla()}"
            					oncomplete="PrimeFaces.focus('frmListProducto:tvPLmain:fsvAdquisicion:innCantDt');">
								<i class="fa fa-edit fs-18 text-gray-900"></i>
								<!-- <span class="fs-12 text-gray-800 font-light">EDITAR</span> -->
								<f:setPropertyActionListener value="ADQUISICION" target="#{listaProductoCtrl.callModule}"/>
								<f:setPropertyActionListener value="EDITAR" target="#{listaProductoCtrl.accion}"/>
								<f:setPropertyActionListener value=":formMain:adquisicionDetDT :formMain:oupTotales :formMain:oupPagoDT :formMain:intRetRenta :formMain:intRetRentaPorcentaje :formMain:intRetIva :formMain:intRetIvaPorcentaje" target="#{listaProductoCtrl.viewUpdate}"/>
								<f:setPropertyActionListener value="formMain" target="#{listaProductoCtrl.formModule}"/>
								<f:setPropertyActionListener value="#{adquisicionFrmCtrl}" target="#{listaProductoCtrl.adquisicionFrmCtrl}"/>
								<f:setPropertyActionListener value="#{adquisicionFrmCtrl.establecimientoMain}" target="#{listaProductoCtrl.establecimientoMain}"/>
								<f:setPropertyActionListener value="#{d}" target="#{adquisicionFrmCtrl.adquisiciondetalleSelected}"/>
								<f:setPropertyActionListener value="#{false}" target="#{adquisicionFrmCtrl.adquisiciondetalleSelected.flagCalcularDetForm}"/> 
							</p:commandLink>
							
							<p:commandLink id="clkAdqDelete" 
								action="#{adquisicionFrmCtrl.eliminarDetalle()}" 
								title="ELIMINAR" 
								update=":formMain:adquisicionDetDT :formMain:oupTotales :formMain:oupPagoDT :formMain:intRetRenta :formMain:intRetRentaPorcentaje :formMain:intRetIva :formMain:intRetIvaPorcentaje" process="@this :formMain:adquisicionDetDT" disabled="#{adquisicionFrmCtrl.adquisicionSelected.estado!=ComprobanteEstadoEnum.REGISTRADO}" 
								styleClass="p-3 det-item-hover" 
            					style="border-radius:100%; border: 1px solid #b3d7ff;width:4.1rem;height:4.1rem;">
								<!-- <span class="fs-12 text-pink-400">ELIMINAR</span> -->
								<i class="fa-regular fa-trash-can fs-18 text-gray-900"></i>
								<p:confirm header="#{msg['label.confirmacion']}" message="#{msg['mensaje.confimacion']}" icon="fa fw-3x fa-exclamation-triangle" />
								<f:setPropertyActionListener value="#{d}" target="#{adquisicionFrmCtrl.adquisiciondetalleSelected}"/>
							</p:commandLink>
            						
            			</div>
            			<div class="flex-grow-1 flex flex-order-0 md:flex-order-1">
            				
            				<div class="flex justify-content-evenly w-full">
            					<div class="min-width-85 mr-1 align-self-center">
            						<div class="flex w-full gap-2">
	            						<div class="flex flex-column">
	            							<span style="color:black;" class="font-light">Cantidad</span>
	            							<p:inputNumber id="innCantDt" value="#{d.cantidad}"
			                            	    symbolPosition="s" emptyValue="zero" decimalPlaces="0" 
			                            	    rendered="#{d.producto!=null and (d.producto.tipoventa==1 or d.producto.tipoventa==3)}"
			                            	    inputStyleClass="fs-12 p-1">
			                            	    <p:ajax listener="#{adquisicionFrmCtrl.calcularAdquicisioDetalleProductoAction(d,true)}"  update=":formMain:adquisicionDetDT :formMain:oupTotales :formMain:oupPagoDT :formMain:intRetRenta :formMain:intRetRentaPorcentaje :formMain:intRetIva :formMain:intRetIvaPorcentaje"/>
			                            	</p:inputNumber>		                                
			                            	<p:inputNumber id="innCantDt2" value="#{d.cantidad}"
			                                	symbolPosition="s" emptyValue="zero" decimalPlaces="3" 
			                                	rendered="#{d.producto==null or d.producto.tipoventa!=1}" inputStyleClass="fs-12 p-1">
			                                	<p:ajax listener="#{adquisicionFrmCtrl.calcularAdquicisioDetalleProductoAction(d,true)}"  update=":formMain:adquisicionDetDT :formMain:oupTotales :formMain:oupPagoDT :formMain:intRetRenta :formMain:intRetRentaPorcentaje :formMain:intRetIva :formMain:intRetIvaPorcentaje"/>
			                                </p:inputNumber>
	            						</div>
	            						<div class="flex flex-column">
	            							<span style="color:black;" class="font-light">Valor unitario</span>
	            							<p:inputNumber id="innPuDt" value="#{d.preciounitario}" symbol="$"
	                                			symbolPosition="p" emptyValue="zero" decimalPlaces="2" inputStyleClass="fs-12 p-1">
	                                			<p:ajax listener="#{adquisicionFrmCtrl.calcularAdquicisioDetalleProductoAction(d,true)}"  update=":formMain:adquisicionDetDT :formMain:oupTotales :formMain:oupPagoDT :formMain:intRetRenta :formMain:intRetRentaPorcentaje :formMain:intRetIva :formMain:intRetIvaPorcentaje"/>
	                                		</p:inputNumber>
	            						</div>
	            						<div class="hidden md:flex flex-column">
	            							<span style="color:black;" class="font-light">Descuento</span>
	            							<p:inputNumber id="innPuDesct" value="#{d.descuento}" symbol="$"
	                                			symbolPosition="p" emptyValue="zero" decimalPlaces="2" inputStyleClass="fs-12 p-1">
	                                			<p:ajax listener="#{adquisicionFrmCtrl.calcularAdquicisioDetalleProductoAction(d,true)}"  update=":formMain:adquisicionDetDT :formMain:oupTotales :formMain:oupPagoDT :formMain:intRetRenta :formMain:intRetRentaPorcentaje :formMain:intRetIva :formMain:intRetIvaPorcentaje"/>
	                                		</p:inputNumber>
	            						</div>
            						</div>
            					</div>
            					
            					<div class="min-width-80 hidden md:block ">
            						<div class="flex flex-column justify-content-center align-items-end h-full">
			           					<!-- <div class="flex gap-1 align-items-end">
			           						<h:outputText value="#{d.descuento}" styleClass="fs-11 text-gray-900">
												<f:convertNumber  pattern="#{appSessionCtrl.formatoMoneda}"/>
											</h:outputText>
			           						<span class="fs-9 text-gray-600">Desto</span>
			           					</div> -->
			           					<div class="flex gap-1 align-items-end">
			           						<h:outputText value="#{d.valorice}" styleClass="fs-11 text-gray-900">
												<f:convertNumber  pattern="#{appSessionCtrl.formatoMoneda}"/>
											</h:outputText>
			           						<span class="fs-9 text-gray-600 mr-1">I.C.E.</span>
			           					</div>
			           					<div class="flex gap-1 align-items-end">
			           						<h:outputText value="#{d.valoriva}" styleClass="fs-11 text-gray-900">
												<f:convertNumber  pattern="#{appSessionCtrl.formatoMoneda}"/>
											</h:outputText>
			           						<span class="fs-9 text-gray-600 mr-1">I.V.A.</span>
			           					</div>
            							<!-- <h:outputText value="#{d.preciototal}" styleClass="fs-16 text-black font-medium mb-1 text-right">
			            					<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
			           					</h:outputText> -->
            						</div>
            					</div>
            					<div class="min-width-80 h-full flex justify-content-end align-items-center">
            						<h:outputText value="#{d.preciototal}" styleClass="fs-16 text-gray-900 font-medium">
		            					<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
		           					</h:outputText>
            					</div>
            				</div>
            						
            			</div>
            		</div>
            	</div>
            </div>
            
        </p:dataScroller>
		<!-- subtotales -->
		<p:outputPanel id="oupTotales" styleClass="w-full">
			<div class="grid">
				<div class="col-12 md:col-7">
					<div class="grid grid-nogutter justify-content-between">
						<div class="col-8 py-1">
							<div class="w-full">
								<span class="fs-10 mr-1 text-gray-700 font-semibold">Resumen</span>
								<span class="fs-14 text-primary-600 font-medium">TOTALES</span>
							</div>
						</div>
						<div class="col-1 text-center align-self-center">
							<i class="fa fa-angle-down fs-14"></i>
						</div>
						<div class="col-12 mt-1">
							
							<div class="flex mt-1 border-bottom-1 border-blue-100 py-2 align-items-end">
								<div class="flex flex-grow-1 Fs9">
									<i class="fa fa-angle-right mr-1 font-bold"></i>
									<span class="text-gray-800">Sin impuestos</span>
								</div>						
								<div class="flex flex-grow-1">
									<div class="text-right pr-3 w-full">
										<h:outputText value="#{adquisicionFrmCtrl.adquisicionSelected.subtotal}" styleClass="fs-14 text-black font-light">
						   					<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
						   				</h:outputText>
									</div>
								</div>				
							</div>
							
							<div class="flex mt-1 border-bottom-1 border-blue-100 py-2 align-items-end">
								<div class="flex flex-grow-1 Fs9">
									<i class="fa fa-angle-right mr-1 font-bold"></i>
									<span class="text-gray-800">Descuento</span>
								</div>						
								<div class="flex flex-grow-1">
									<div class="text-right pr-3 w-full">
										<h:outputText value="#{adquisicionFrmCtrl.adquisicionSelected.totaldescuento}" styleClass="fs-14 text-black font-light">
						   					<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
						   				</h:outputText>
									</div>
								</div>				
							</div>
							
							<div class="flex mt-1 border-bottom-1 border-blue-100 py-2 align-items-end">
								<div class="flex flex-grow-1 Fs9">
									<i class="fa fa-angle-right mr-1 font-bold"></i>
									<span class="text-gray-800">I.C.E.</span>
								</div>						
								<div class="flex flex-grow-1">
									<div class="text-right pr-3 w-full">
										<h:outputText value="#{adquisicionFrmCtrl.adquisicionSelected.totalice}" styleClass="fs-14 text-black font-light">
						   					<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
						   				</h:outputText>
									</div>
								</div>				
							</div>
							
							<div class="flex mt-1 border-bottom-1 border-blue-100 py-2 align-items-end">
								<div class="flex flex-grow-1 Fs9">
									<i class="fa fa-angle-right mr-1 font-bold"></i>
									<span class="text-gray-800">I.V.A.</span>
								</div>						
								<div class="flex flex-grow-1">
									<div class="text-right pr-3 w-full">
										<h:outputText value="#{adquisicionFrmCtrl.adquisicionSelected.totaliva}" styleClass="fs-14 text-black font-light">
						   					<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
						   				</h:outputText>
									</div>
								</div>				
							</div>
								
						</div>
					</div>
				</div>
				<div class="col-12 md:col-5 align-self-center text-center py-2">
					<h:outputText value="#{adquisicionFrmCtrl.adquisicionSelected.totalfactura}" styleClass="fs-25 text-primary-600 font-medium inline">
						<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
					</h:outputText>
					<span class="inline fs-10 text-gray-700 ml-1">TOTAL</span>
				</div>
			</div>
		</p:outputPanel>
	</div>
			
</ui:composition>
