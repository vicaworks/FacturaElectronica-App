<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:o="http://omnifaces.org/ui"
				xmlns:of="http://omnifaces.org/functions"
				xmlns:pe="http://primefaces.org/ui/extensions">
	
    <style type="text/css">
    	
    	.compRetSriDT .ui-datatable-scrollable-body{
			min-height: 35vh !important;
			height: calc(100vh - 320px)!important;
		}
    	
    </style>
	
	
	<div class="card">
	
		<div class="grid ui-fluid main__opciones px-2">
			<div class="col-12 md:col-3">
				<div class="field">
					<label class="text-gray-800">Fechas</label>
					<div class="flex gap-2">
						<p:calendar id="calDesde" value="#{compRecRetencionCtrl.desde}"
							pattern="dd/MM/yyyy"
							locale="es" 
							requiredMessage="Requerido" required="true" placeholder="dd/MM/yyyy">
						</p:calendar>
						<p:calendar id="calHasta" value="#{compRecRetencionCtrl.hasta}"
							pattern="dd/MM/yyyy"
							locale="es" 
							requiredMessage="Requerido" required="true" placeholder="dd/MM/yyyy">
						</p:calendar>
						
					</div>
				</div>
			</div>
			<div class="col-12 md:col-6">
				<div class="field">
					<label class="text-gray-800">Criterio de búsqueda</label>
					<p:inputText value="#{compRecRetencionCtrl.criterioBusqueda}" placeholder="# Factura, R.U.C., Nombre emisor"/>
				</div>
			</div>
			
			<div class="mt-2 col-12 md:col-3 md:mt-0">
				<div class="inline-flex gap-2 h-full align-items-end">
					<p:commandButton 
						icon="fa fa-search"
						action="#{compRecRetencionCtrl.buscar()}" 
						styleClass="ui-button-success" 
						update="@form" 
						value="Buscar"/>
				</div>
			</div>
			
		</div>
		
		<div class="flex my-2 align-items-center gap-2">
			<i class="fa fa-ellipsis-v fs-14"/> 
			<p:commandLink id="cmdGlobalRTExcelSeleccion" disabled="#{empty compRecRetencionCtrl.comprobanteRecibidoList}" styleClass="min-width-80">
				<div class="flex gap-1">
					<span class="text-gray-900 fs-12">Selección</span>
					<i class="fa fa-angle-down fs-14 text-gray-900" />
				</div>
			</p:commandLink>
			<p:menu overlay="true" trigger="cmdGlobalRTExcelSeleccion" my="left top" at="left bottom" style="width:250px !important;" >
				<p:menuitem value="Exportar comprobantes PDF" icon="fa-regular fa-file-pdf fs-12" ajax="false">
					<p:fileDownload value="#{compRecRetencionCtrl.descargarSeleccion}" contentDisposition="inline"/>
				</p:menuitem>				
			</p:menu>
			
			
			<p:commandLink id="cmdGlobalExcel" disabled="#{empty compRecRetencionCtrl.comprobanteRecibidoList}" styleClass="min-width-80">
				<div class="flex gap-1">
					<span class="text-gray-900 fs-12">Exportar</span>
					<i class="fa fa-angle-down fs-14 text-gray-900" />
				</div>
			</p:commandLink>
			<p:menu overlay="true" trigger="cmdGlobalExcel" my="left top" at="left bottom" style="width:250px !important;">
				<p:menuitem value="Exportar excel" icon="fa-regular fa-file-excel fs-12" ajax="false">
					<p:fileDownload value="#{compRecRetencionCtrl.fileResumen}" contentDisposition="inline"/>
				</p:menuitem>
				<p:menuitem value="Exportar excel(detalle)" icon="fa fa-list fs-12" ajax="false">
					<p:fileDownload value="#{compRecRetencionCtrl.fileDetalle}" contentDisposition="inline"/>
				</p:menuitem>
			</p:menu>
			
			<p:link href="#divTotales" styleClass="min-width-80" disabled="#{empty compRecRetencionCtrl.comprobanteRecibidoList}">
				<div class="flex gap-1">
					<span class="text-primary-600 fs-12">Ver Totales</span>
					<!-- <i class="fa fa-angle-down fs-18 text-white font-semibold" /> -->
				</div>
		    </p:link>
			
		</div>
		
		<p:dataTable id="compRetSriDT" var="ret"
						value="#{compRecRetencionCtrl.comprobanteRecibidoList}" 
						scrollable="true"
						emptyMessage="#{msg['mensaje.noexistenDatos']}"
						styleClass="compRetSriDT fs-11 text-gray-900"  
						rowKey="#{ret.idcomprobanterecibido}"
						rows="30"
						rowIndexVar="row"
		                paginator="true"
		                paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
		                currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
		                paginatorPosition="bottom"  
						rowsPerPageTemplate="10,15,20,25,30,35,40"
						selection="#{compRecRetencionCtrl.comprobanteRecibidoSeleccionList}">
		    
		    <p:ajax  event="toggleSelect" listener="#{compRecRetencionCtrl.selectAllComprobantesRecibidos}" update=":formMain:fsvRetencion:compRetSriDT"/>
		    
		    <p:column style="width:15px;">
		    	<span class="fs-12 text-gray-900">#{row + 1}</span>
		    </p:column>
		    
		    <p:column selectionMode="multiple" style="width:20px" styleClass="text-center"/>
		    
		    <p:column headerText="Opc" style="width:15px;">
		    	<p:commandLink id="cmlDtFacEmitidas">
					<i class="fa fa-chevron-circle-down fs-18 text-gray-800" />
				</p:commandLink>
				
				<p:menu overlay="true" trigger="cmlDtFacEmitidas" my="left top" at="left bottom">
					<p:menuitem value="RIDE" action="#{compRecRetencionCtrl.showRide()}" icon="fa-regular fa-file-pdf fs-14">
						<f:setPropertyActionListener value="#{ret}" target="#{compRecRetencionCtrl.comprobanteRecibidoSelected}"/>
						<f:setPropertyActionListener value="#{rideCtrl}" target="#{compRecRetencionCtrl.rideCtrl}"/>
					</p:menuitem>
					<p:menuitem value="Ver XML formato" icon="fa fa-eye fs-14" oncomplete="PF('dlgCRImportXml').show();" update=":formCRXml" action="#{compRecibidosCtrl.formatoValorXml()}">
						<f:setPropertyActionListener value="#{ret}" target="#{compRecibidosCtrl.comprobanteRecibidoSelected}"/>
						<f:setPropertyActionListener value="#{ret.valorXml}" target="#{compRecibidosCtrl.xml}"/>
						<f:setPropertyActionListener value="#{true}" target="#{compRecibidosCtrl.formatoXml}"/>
					</p:menuitem>
					
					<p:menuitem value="Ver XML original" icon="fa fa-eye fs-14" oncomplete="PF('dlgCRImportXml').show();" update=":formCRXml" action="#{compRecibidosCtrl.formatoValorXml()}">
						<f:setPropertyActionListener value="#{ret}" target="#{compRecibidosCtrl.comprobanteRecibidoSelected}"/>
						<f:setPropertyActionListener value="#{ret.valorXml}" target="#{compRecibidosCtrl.xml}"/>
						<f:setPropertyActionListener value="#{false}" target="#{compRecibidosCtrl.formatoXml}"/>
					</p:menuitem>
				</p:menu>	
		    </p:column>    
		    
		    <p:column headerText="Comprobante" style="width:120px;">
				<h:outputText value="#{facEmitidaCtrl.getFormatoNumDocumento(ret.serieComprobante)}" />
			</p:column>
			
			<p:column headerText="#{msg['label.emision']}" style="width:70px;">
				<h:outputText value="#{ret.fechaEmision}" >
					<f:convertDateTime pattern="dd/MM/yyyy"/>
				</h:outputText>
			</p:column>
			
			<p:column headerText="Autorización" style="width:70px;">
				<h:outputText value="#{ret.fechaAutorizacion}" >
					<f:convertDateTime pattern="dd/MM/yyyy"/>
				</h:outputText>
			</p:column>
			
			<p:column headerText="Emisor Id" style="width:90px;" filterBy="#{ret.rucEmisor}" filterMatchMode="contains">
				<h:outputText value="#{ret.rucEmisor}" />
			</p:column>
			
			<p:column headerText="Emisor" style="width:200px;" filterBy="#{ret.razonSocialEmisor}" filterMatchMode="contains">
				<h:outputText value="#{ret.razonSocialEmisor}" styleClass="uppercase text-primary-600 fw-3">
				</h:outputText>
			</p:column>
					
			<p:column headerText="Renta" style="width:80px;" styleClass="text-center">
				<div class="flex justify-content-end">
					<h:outputText value="#{ret.totalrenta}" styleClass="#{ret.totalrenta.doubleValue()==0.0?'opacity-60':''}">
						<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
					</h:outputText>
				</div>
			</p:column>
			
			<p:column headerText="Iva" style="width:80px;" styleClass="text-center">
				<div class="flex justify-content-end">
					<h:outputText value="#{ret.totaliva}" styleClass="#{ret.totaliva.doubleValue()==0.0?'opacity-60':''}">
						<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
					</h:outputText>
				</div>
			</p:column>
			
			<p:column headerText="Total" style="width:80px;" styleClass="text-center">
				<div class="flex justify-content-end">
					<h:outputText value="#{ret.totalretencion}" styleClass="text-gray-800 fw-5">
						<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
					</h:outputText>
				</div>
			</p:column>
					
		
		</p:dataTable>
		
		<div class="grid justify-content-end" id="divTotales">
			<div class="col-12 md:col-5 lg:col-4">
				<div class="grid grid-nogutter justify-content-between">
					<div class="col-7 py-2">
						<div class="w-full text-left">
							<span class="fs-12 mr-1 text-gray-700 font-semibold">Total</span>
							<span class="fs-14 text-blue-600 font-medium">RESUMEN</span>
						</div>
					</div>
					<div class="col-1 text-center align-self-center">
						<i class="fa fa-angle-down fs-14"></i>
					</div>
					<div class="col-12 mt-1">
						<div class="flex mt-1 border-bottom-1 border-blue-100 py-2 align-items-end">
							<div class="flex flex-grow-1 fs-12">
								<i class="fa fa-angle-right mr-1 font-bold"></i>
								<span class="text-gray-800"><h:outputText value="Impuesto a la renta" /></span>
							</div>						
							<div class="flex flex-grow-1">
								<div class="text-right pr-3 w-full fs-14">
									<h:outputText value="#{compRecRetencionCtrl.comprobanteRecibidoTotal.totalrenta}">
										<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
									</h:outputText>
								</div>
							</div>				
						</div>
						
						<div class="flex mt-1 border-bottom-1 border-blue-100 py-2 align-items-end">
							<div class="flex flex-grow-1 fs-12">
								<i class="fa fa-angle-right mr-1 font-bold"></i>
								<span class="text-gray-800"><h:outputText value="I.V.A." /></span>
							</div>						
							<div class="flex flex-grow-1">
								<div class="text-right pr-3 w-full fs-14">
									<h:outputText value="#{compRecRetencionCtrl.comprobanteRecibidoTotal.totaliva}">
										<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
									</h:outputText>
								</div>
							</div>				
						</div>
						
						<div class="flex mt-1 border-bottom-1 border-blue-100 py-2 align-items-end">
							<div class="flex flex-grow-1 fs-12">
								<i class="fa fa-angle-right mr-1 font-bold"></i>
								<span class="text-gray-800"><h:outputText value="Total retenido" /></span>
							</div>						
							<div class="flex flex-grow-1">
								<div class="text-right pr-3 w-full fs-14">
									<h:outputText value="#{compRecRetencionCtrl.comprobanteRecibidoTotal.totalretencion}">
										<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
									</h:outputText>
								</div>
							</div>				
						</div>
					</div>
				</div>
			</div>
		</div>
		
	</div>

</ui:composition>
