<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:o="http://omnifaces.org/ui"
				xmlns:of="http://omnifaces.org/functions"
				xmlns:pe="http://primefaces.org/ui/extensions">
	
     <style type="text/css">
     	
     	.compSriDT .ui-datatable-scrollable-body{
			min-height: 40vh !important;
			height: calc(100vh - 255px)!important;
		}
		
		.toolbar_upload .ui-fileupload .ui-fileupload-content{
			display: none;
		}
     	.toolbar_upload .ui-fileupload .ui-fileupload-buttonbar {
     		all: revert!important;
     	}
     </style>
	
	<p:remoteCommand process="@this" actionListener="#{compRecibidosCtrl.inicializarUploadXml()}" name="inicializarUploadXml"/>
	<p:remoteCommand process="@this" actionListener="#{compRecibidosCtrl.showMessageUploadXml()}" name="showMessageUploadXml"/>
	
	<div class="card">  
		
		
		<div class="flex justify-content-between align-items-baseline">
			<h3 class="card__heading card__heading--noBorder fw-4">Importar comprobantes</h3>
			<p:progressBar widgetVar="pbAjax" ajax="true" value="#{compRecibidosCtrl.progress}" labelTemplate="{value}%" styleClass="animated" global="false" interval="250" style="width:30rem">
				<p:ajax event="complete" update="@form" oncomplete="PF('w_cmdCRGuardar').enable();PF('w_cmdCRSeleccionarFile').enable();"/>
		    </p:progressBar>
		</div>
			
		<div class="toolbar_upload flex gap-2 my-2 flex-wrap">
		
			<p:commandButton id="cmdCRSeleccionarFileSri" 
				widgetVar="w_cmdCRSeleccionarFileSri"
				icon="fa fa-search"
				process="@this"
				action="#{compRecibidosCtrl.showUploadFile()}" 
				styleClass="fs-12 ui-button-success min-width-80 #{appSessionCtrl.accesoDisable('mn_comprecib_importar')?'ui-state-disabled':''}" 
				update="@form" 
				value="Archivo SRI"
				title="Seleccionar archivo de comprobantes SRI"/>
				
			<p:fileUpload id="fileUploadCRSeleccionarFileXml"
				listener="#{compRecibidosCtrl.uploadComprobantesXml}"
				label="Archivos XML"				
				sizeLimit="50485760"
				invalidSizeMessage="#{msg['file.size']} 4MB" 
				mode="advanced" 
				dragDropSupport="true" 
				auto="true"
				update="@form"
				previewWidth="0"
				chooseButtonStyleClass="fs-12 ui-button-success min-width-80 m-0"
				multiple="true"
				onstart="inicializarUploadXml();"
				oncomplete="showMessageUploadXml();">
			</p:fileUpload>
				
			<p:commandButton id="cmdCRGuardarArchivo" widgetVar="w_cmdCRGuardarArchivo"
				icon="fa fa-floppy-disk"
				process="@this"
				onclick="PF('w_cmdCRlimpiar').disable();PF('w_cmdCRGuardar').disable();PF('w_cmdCRSeleccionarFile').disable();PF('pbAjax').cancel();PF('pbAjax').start();"
				action="#{compRecibidosCtrl.cargarComprobantes()}" 
				styleClass="fs-12 ui-button-primary  min-width-60 #{appSessionCtrl.accesoDisable('mn_comprecib_importar')?'ui-state-disabled':''}" 
				update="@form"
				value="Guardar" 
				disabled="#{compRecibidosCtrl.fileComprobantes==null}"
				rendered="#{compRecibidosCtrl.tipoCargar == 'ARCHIVO_SRI'}"
				title="Guarda los comprobantes"/>
			
			<p:commandButton id="cmdCRGuardarArchivoXml" widgetVar="w_cmdCRGuardarArchivo"
				icon="fa fa-floppy-disk fs-12"
				process="@this"
				onclick="PF('w_cmdCRlimpiar').disable();PF('w_cmdCRGuardar').disable();PF('w_cmdCRSeleccionarFile').disable();PF('pbAjax').cancel();PF('pbAjax').start();"
				action="#{compRecibidosCtrl.cargarComprobantesXML()}" 
				styleClass="fs-12 ui-button-primary min-width-60 #{appSessionCtrl.accesoDisable('mn_comprecib_importar')?'ui-state-disabled':''}" 
				update="@form"
				value="Guardar" 
				disabled="#{empty compRecibidosCtrl.fileSriDtoList}"
				rendered="#{compRecibidosCtrl.tipoCargar == 'ARCHIVO_XML'}"
				title="Guarda los comprobantes"/>
						
		    <p:commandButton id="cmdCRlimpiar" 
		    	widgetVar="w_cmdCRlimpiar"
				icon="fa fa-eraser fs-12"
				process="@this"
				styleClass="fs-12 ui-button-outlined ui-button-secondary min-width-60" 
				update="@form"
				value="Limpiar" 
				action="#{compRecibidosCtrl.limpiar()}"
				title="Limpia los datos de pantalla">
			</p:commandButton>
			
						
						
			<p:linkButton value="Ayuda" 
				styleClass="fs-12 min-width-60 ui-button-outlined ui-button-success" 
				icon="pi pi-tags fs-12" 
				target="_black" 
				href="#{request.contextPath}/manuales/importComprobante.html" 
				title="Manual de Usuario">
		    </p:linkButton>
			
		</div>
		
		<p:dataTable id="compSriDT" var="f"
						value="#{compRecibidosCtrl.fileSriDtoList}" 
						scrollable="true"
						emptyMessage="#{msg['mensaje.noexistenDatos']}"
						styleClass="compSriDT fs-12"  
						rowKey="#{f.id}"
						rows="30"
						rowIndexVar="row"
		                paginator="true"
		                paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
		                currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
		                paginatorPosition="bottom"  
						rowsPerPageTemplate="20,30,35,40">    
		    
		    <p:column style="width:15px;">
		    	<span class="fs-12 text-gray-900">#{row + 1}</span>
		    </p:column>
		    
		    <p:column headerText="Estado" style="width:90px;">
		    	<p:outputPanel id="oupestado">		    		
		    		<div class="flex">
		    			<div class="flex-grow-1 flex">
							<h:outputText value="#{f.estado}" styleClass="block w-full p-1 text-gray-900 border-round #{f.styleEstado}"/>
		    			</div>
		    			<div class="flex-grow-0 flex px-1 align-self-center">
			    			<f:subview rendered="#{f.desplegarInfo}">
				    			<i class="fa fa-comments fs-14"></i>
			    			</f:subview>
		    				
		    			</div>
		    		</div>
		    	</p:outputPanel>
		    	<p:tooltip id="toolTipEstado" for="oupestado" value="#{f.mensaje}" position="top" rendered="#{f.desplegarInfo}"/>
			</p:column>
		    
		    <p:column headerText="Comprobante" style="width:120px;">
		    	<div class="flex flex-column gap-1">
					<h:outputText value="#{f.comprobante}" styleClass="text-gray-800"/>
					<h:outputText value="#{f.serieComprobante}" styleClass="text-gray-900 fw-5"/>
		    	</div>
			</p:column>        
			
			<p:column headerText="IdentificaciÃ³n" style="width:150px;">
				<div class="flex flex-column gap-1">
					<h:outputText value="#{f.rucEmisor}" styleClass="text-gray-900"/>
					<h:outputText value="#{f.emisor}" styleClass="text-primary-600 fw-4"/>
				</div>
			</p:column>
			
			<p:column headerText="#{msg['label.emision']}" style="width:60px;">
				<h:outputText value="#{f.fechaEmision}" styleClass="text-gray-900">
					<f:convertDateTime pattern="dd/MM/yyyy"/>
				</h:outputText>
			</p:column>
			
			<p:column headerText="#{msg['label.autorizacion']}" style="width:80px;">
				<h:outputText value="#{f.fechaAutorizacion}" styleClass="text-gray-900">
					<f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss"/>
				</h:outputText>
			</p:column>
			
			<p:column headerText="Tipo #{msg['label.emision']}" style="width:50px;">
				<h:outputText value="#{f.tipoEmision}" styleClass="text-gray-900">
				</h:outputText>
			</p:column>
			
			<p:column headerText="Receptor" style="width:70px;">
				<h:outputText value="#{f.identificacionReceptor}" styleClass="text-gray-900">
				</h:outputText>
			</p:column>
			
			<p:column headerText="Importe total" styleClass="text-center" style="width:70px;">
				<div class="flex justify-content-end">
					<h:outputText value="#{f.importeTotal}"  styleClass="text-gray-800 fw-5">
						<f:convertNumber pattern="#{appSessionCtrl.formatoMoneda}"/>
					</h:outputText>
				</div>
			</p:column>
		                
		</p:dataTable>
	
	</div>
	

</ui:composition>
