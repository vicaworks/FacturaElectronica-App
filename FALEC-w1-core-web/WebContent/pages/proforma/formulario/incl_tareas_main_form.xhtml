<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:o="http://omnifaces.org/ui"
				xmlns:of="http://omnifaces.org/functions"
				xmlns:pe="http://primefaces.org/ui/extensions">
	
    <style type="text/css">
 		.pvDosDT .ui-datatable-scrollable-body{
			min-height: 45vh !important;
			height: calc(100vh - 415px)!important;				
		}   
		.dt-etiqueta{
			border-left: 3px solid #34495E;
			padding: 5px;
			font-weight: 400;
		}   	
		.dt-descripcion{padding: 0px!important;padding-top:5px!important; ;color: rgba(0,0,0,0.7);}
    </style>
	
	<div class="card" >		
		
		<div class="grid">
			<div class="col-12 md:col-6">
				<div class="flex gap-1">
					<div class="flex flex-column flex-grow-1 gap-1">
						<h:outputText value="Sucursal" styleClass="fs-11"/>
						<p:selectOneMenu id="somEstablecimientoMain"
							value="#{cotizacionCtrl.establecimientoMain}"
							converter="omnifaces.SelectItemsConverter"
							disabled="#{not facEmitidaCtrl.habilitarEstablecimientoMain}"
							styleClass="w-full">
							
							<f:selectItems value="#{cotizacionCtrl.establecimientoMainList}" var="st"
								itemLabel="#{appSessionCtrl.formatoCadena(st.codigoestablecimiento,3,'0').concat(' - ').concat(st.nombrecomercial)}" itemValue="#{st}" />
							
							<p:ajax event="valueChange" listener="#{facEmitidaCtrl.buscar()}" update="@form"/>								
						</p:selectOneMenu>		                
					</div>
					<div class="flex flex-column flex-grow-1 gap-1">
						<h:outputText value="Estado" styleClass="fs-11"/>
			    		<p:selectOneMenu id="somtareaEst"
									value="#{tareaCotMainCtrl.estadoSeleccion}"
									styleClass="w-full">
							
							<f:selectItem itemLabel="Todos" itemValue="#{null}"/>								
							<f:selectItem itemLabel="Pendiente" itemValue="PENDIENTE"/>
							<f:selectItem itemLabel="Pendiente / Vencido" itemValue="PENDIENTE-VENCIDO"/>
							<f:selectItem itemLabel="Vencido" itemValue="VENCIDO"/>
							<f:selectItem itemLabel="Cerrado" itemValue="CERRADO"/>									
						</p:selectOneMenu>							
					</div>
					<div class="flex flex-column flex-grow-1 gap-1">
						<h:outputText value="Prioridad" styleClass="fs-11"/>
			    		<p:selectOneMenu id="somtareaPrioridad"
									value="#{tareaCotMainCtrl.prioridadSeleccion}"
									styleClass="w-full">								
							<f:selectItem itemLabel="Todos" itemValue="#{null}"/>								
							<f:selectItem itemLabel="Importante" itemValue="IMPORTANTE"/>
							<f:selectItem itemLabel="Importante / Alta" itemValue="IMPORTANTE-ALTA"/>
							<f:selectItem itemLabel="Alta" itemValue="ALTA"/>
							<f:selectItem itemLabel="Media" itemValue="MEDIA"/>
							<f:selectItem itemLabel="Baja" itemValue="BAJA"/>									
						</p:selectOneMenu>
					</div>					
				</div>
			</div>
			
			<div class="col-12 md:col-6">				
				<div class="flex flex-column gap-1">
					<h:outputText value="Cliente" styleClass="fs-11"/>
		    		<p:selectOneMenu id="somtareaCliente"
								value="#{tareaCotMainCtrl.clienteSeleccion}"
								converter="omnifaces.SelectItemsConverter"
								styleClass="w-full">						
						<f:selectItem itemLabel="Todos"
												itemValue="#{null}" value="#{null}" noSelectionOption="true" />
						<f:selectItems value="#{tareaCotMainCtrl.clienteList}" var="c"
							itemLabel="#{c.razonsocial}" itemValue="#{c}" />
					</p:selectOneMenu>		
				</div>
			</div>
			<div class="col-12 md:col-6">
				<div class="flex flex-column gap-1">
					<h:outputText value="Vendedor" styleClass="fs-11"/>
		    		<p:selectOneMenu id="somtareaUsuario"
						value="#{tareaCotMainCtrl.usuarioSeleccion}"
						converter="omnifaces.SelectItemsConverter"
						styleClass="w-full"
						disabled="#{tareaCotMainCtrl.disableUsuario}">
						
						<f:selectItem itemLabel="TODOS"
												itemValue="#{null}" value="#{null}" noSelectionOption="true" />
						<f:selectItems value="#{tareaCotMainCtrl.usuarioList}" var="u"
							itemLabel="#{u.nombre}" itemValue="#{u}" />
							
					</p:selectOneMenu>				
				</div>
			</div>
			<div class="col-12 md:col-6">
				<div class="flex gap-1">
					<div class="flex flex-column flex-grow-1 gap-1">
						<h:outputText value="# Cotización" styleClass="fs-11"/>
						<p:inputText value="#{tareaCotMainCtrl.numCotizacion}"></p:inputText>	    									
					</div>
					<div class="flex flex-grow-0 gap-1">
						<div class="flex h-full align-items-end">
							<p:commandButton 
							icon="fa fa-search" 
							action="#{tareaCotMainCtrl.buscar}" styleClass="ui-button-success" update="@form" value="Buscar"/>						
						</div>
					</div>					
				</div>
			</div>
		</div>
		<p:messages id="msgtarea" rendered="#{not facesContext.validationFailed}" showSummary="true" showDetail="true" for="formMain"
			closable="true" styleClass="m-0 p-0">
			<p:autoUpdate></p:autoUpdate>
		</p:messages>
	</div>
	<!-- Mensajes -->
	<div class="card">
		
		<div class="grid justify-content-start md:justify-content-end">
			<div class="col-6 lg:col-4">
				<div class="grid grid-gutter">
					<div class="col">
						<div class="flex flex-inline justify-content-center">
							<i class="fa fa-cancel fs-20 align-self-center mx-3"></i>
							<div class="flex flex-column">
								<div class="w-full py-1 pl-3 text-right">
									<h:outputText value="#{tareaCotMainCtrl.totalCerrado}" styleClass="fs-18 text-gray-700 font-medium">
										<f:convertNumber pattern="#{appSessionCtrl.formatoInteger}"/>
									</h:outputText>
								</div>
								<div class="w-full py-1 pl-2">
									<span class="fs-9 mr-1 text-gray-300 font-semibold">TOTAL</span>
									<span class="fs-12 text-gray-600 font-semibold">CERRADO</span>
								</div>
							</div>
						</div>
					</div>
					<div class="col-fixed" style="width:20px"><p:divider layout="vertical" /></div>
				</div>
			</div>
			
			<div class="col-6 lg:col-4">
				<div class="grid grid-gutter">
					<div class="col">
						<div class="flex flex-inline justify-content-center">
							<i class="fa-solid  fa-circle-check fs-20 text-green-600 fw-5 align-self-center mx-3"></i>
							<div class="flex flex-column">
								<div class="w-full py-1 pl-3 text-right">
									<h:outputText value="#{tareaCotMainCtrl.totalPendiente}" styleClass="fs-18 text-green-600 font-medium">
										<f:convertNumber pattern="#{appSessionCtrl.formatoInteger}"/>
									</h:outputText>
								</div>
								<div class="w-full py-1 pl-2">
									<span class="fs-9 mr-1 text-gray-300 font-semibold">TOTAL</span>
									<span class="fs-12 text-gray-600 font-semibold">PENDIENTE</span>
								</div>
							</div>
						</div>
					</div>
					<div class="col-fixed" style="width:20px"><p:divider layout="vertical" /></div>
				</div>
			</div>
			
			<div class="col-6 lg:col-4">
				<div class="grid grid-gutter">
					<div class="col">
						<div class="flex flex-inline justify-content-center">
							<i class="fa  fa-angle-double-down fs-20 text-pink-400 font-bold align-self-center mx-3"></i>
							<div class="flex flex-column">
								<div class="w-full py-1 pl-3 text-right">
									<h:outputText value="#{tareaCotMainCtrl.totalVencido}" styleClass="fs-18 text-pink-400 font-medium">
										<f:convertNumber pattern="#{appSessionCtrl.formatoInteger}"/>
									</h:outputText>
								</div>
								<div class="w-full py-1 pl-2">
									<span class="fs-9 mr-1 text-gray-300 font-semibold">TOTAL</span>
									<span class="fs-12 text-gray-600 font-semibold">VENCIDO</span>
								</div>
							</div>
						</div>
					</div>
					<div class="col-fixed" style="width:20px"><p:divider layout="vertical" /></div>
				</div>
			</div>
			
		</div>
		
		<div class="flex mb-1 align-items-baseline gap-1">
			<i class="fa fa-ellipsis-v fs-16"/>
			<p:commandLink id="cmdGlobalExcel" disabled="#{empty tareaCotMainCtrl.tareacabeceraList}" styleClass="min-width-80 flex gap-1 align-items-end">
				<span class="mr-1 text-gray-900 fs-12 font-light">Exportar</span>
				<i class="fa fa-angle-down fs-12 text-gray-900 font-semibold" />
			</p:commandLink>
			<p:menu overlay="true" trigger="cmdGlobalExcel" my="left top" at="left bottom" style="width:250px !important;">
				<p:menuitem value="Exportar excel" icon="fa-regular fa-file-excel fs-14" ajax="false">
					<p:fileDownload value="#{tareaCotMainCtrl.fileResumen}" contentDisposition="inline"/>
				</p:menuitem>
			</p:menu>
		</div>
				
		<p:dataTable id="pvDosDT"
	      			scrollable="true"
	      			value="#{tareaCotMainCtrl.tareacabeceraList}"
	      			var="t"
	      			emptyMessage="#{msg['mensaje.noexistenDatos']}"
				styleClass="pvDosDT fs-11"
	               paginator="true"
	               paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
	               currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
	               paginatorPosition="bottom"  
				rowKey="#{t.idtareacabecera}"
				rows="20"
				rowsPerPageTemplate="10,15,20,25,30,35,40">
				
				
				<p:column headerText="Opc" style="width:20px;">
					<p:commandLink id="cmlDttareas">
						<i class="fa fa-chevron-circle-down fs-18" style="color:#252529;"/>
					</p:commandLink>
					<p:menu overlay="true" trigger="cmlDttareas" my="left top" at="left bottom">
						
						<p:menuitem value=" Imprimir" action="#{rideCtrl.showCotizacion()}" icon="fa fa-print fs-14" process="pvDosDT" update="@form:tarea:pvDosDT @form:tarea:msgtarea" disabled="#{cotizacionCtrl.accesoOpciones('IMPRIMIR',t.cabecera.estado)}" 
							styleClass="#{appSessionCtrl.accesoDisable('mn_cotizacion_tarea_imprimir')?'ui-state-disabled':''}">
							<f:setPropertyActionListener value="#{t.cabecera.idcabecera}" target="#{rideCtrl.idCabecera}"/>
						</p:menuitem>
						
						
						<p:menuitem value=" Agregar tarea" action="#{tareaCotCtrl.nuevaTarea}" icon="fa fa-plus fs-14" process="pvDosDT" update="@form:tarea:pvDosDT @form:tarea:msgtarea" 
							styleClass="#{appSessionCtrl.accesoDisable('mn_cotizacion_tarea_agregar')?'ui-state-disabled':''}">
							<f:setPropertyActionListener value="SEGUIMIENTO" target="#{tareaCotCtrl.callModule}"/>
							<f:setPropertyActionListener value="#{t}" target="#{tareaCotCtrl.tareacabeceraSelected}"/>
							<f:setPropertyActionListener value="formMain" target="#{tareaCotCtrl.callForm}"/>
							<f:setPropertyActionListener value=":formMain:tarea:msgtarea :formMain:tarea:pvDosDT" target="#{tareaCotCtrl.updateView}"/>
							<f:setPropertyActionListener value="#{t.cabecera}" target="#{tareaCotCtrl.cotizacionSelected}"/>
						</p:menuitem>
						
						<p:menuitem value=" Editar tarea" action="#{tareaCotCtrl.editar}" icon="fa fa-edit fs-14" process="pvDosDT" update="@form:tarea:pvDosDT @form:tarea:msgtarea" 
							styleClass="#{appSessionCtrl.accesoDisable('mn_cotizacion_tarea_editar')?'ui-state-disabled':''}">
							<f:setPropertyActionListener value="SEGUIMIENTO" target="#{tareaCotCtrl.callModule}"/>
							<f:setPropertyActionListener value="#{t}" target="#{tareaCotCtrl.tareacabeceraSelected}"/>
							<f:setPropertyActionListener value="formMain" target="#{tareaCotCtrl.callForm}"/>
							<f:setPropertyActionListener value=":formMain:tarea:msgtarea :formMain:tarea:pvDosDT" target="#{tareaCotCtrl.updateView}"/>
							<f:setPropertyActionListener value="#{t.cabecera}" target="#{tareaCotCtrl.cotizacionSelected}"/>
						</p:menuitem>
						
						<p:menuitem value=" Cerrar tarea" action="#{tareaCotCtrl.cerrar}" icon="fa fa-cancel fs-14" process="pvDosDT" update="@form:tarea:pvDosDT @form:tarea:msgtarea" disabled="#{t.estado=='CERRADO'}" 
							styleClass="#{appSessionCtrl.accesoDisable('mn_cotizacion_tarea_cerrar')?'ui-state-disabled':''}">
							<f:setPropertyActionListener value="SEGUIMIENTO" target="#{tareaCotCtrl.callModule}"/>
							<f:setPropertyActionListener value="#{t}" target="#{tareaCotCtrl.tareacabeceraSelected}"/>
							<f:setPropertyActionListener value="formMain" target="#{tareaCotCtrl.callForm}"/>
							<f:setPropertyActionListener value=":formMain:tarea:msgtarea :formMain:tarea:pvDosDT" target="#{tareaCotCtrl.updateView}"/>
							<f:setPropertyActionListener value="#{t.cabecera}" target="#{tareaCotCtrl.cotizacionSelected}"/>
						</p:menuitem>
						
						<p:menuitem value=" Eliminar" action="#{tareaCotCtrl.eliminar}" icon="fa-regular fa-trash-can fs-14" process="pvDosDT" update="@form:tarea:pvDosDT @form:tarea:msgtarea" 
							styleClass="#{appSessionCtrl.accesoDisable('mn_cotizacion_tarea_eliminar')?'ui-state-disabled':''}">
							<f:setPropertyActionListener value="SEGUIMIENTO" target="#{tareaCotCtrl.callModule}"/>
							<f:setPropertyActionListener value="#{t}" target="#{tareaCotCtrl.tareacabeceraSelected}"/>
							<f:setPropertyActionListener value="formMain" target="#{tareaCotCtrl.callForm}"/>
							<f:setPropertyActionListener value=":formMain:tarea:msgtarea :formMain:tarea:pvDosDT" target="#{tareaCotCtrl.updateView}"/>
							<f:setPropertyActionListener value="#{t.cabecera}" target="#{tareaCotCtrl.cotizacionSelected}"/>
							<p:confirm header="#{msg['label.confirmacion']}" message="#{msg['mensaje.confimacion']}" icon="fa fw-3x fa-exclamation-triangle" />
						</p:menuitem>
					
					</p:menu>
				</p:column>
				
				<p:column headerText="Fecha" style="width:40px;">
					<h:outputText value="#{t.fechalimite}" >
						<f:convertDateTime pattern="dd/MM/yyyy"/>
					</h:outputText>
				</p:column>
				
				<p:column headerText="Estado" style="width:80px;">
					<div class="flex flex-column text-right gap-1 pr-2">
						<h:outputText value="#{t.estado}" style="#{t.estado=='VENCIDO'?'color:red;':''}">
						</h:outputText>
						<div class="flex flex-column gap-1">
							<div class="flex justify-content-end align-items-end gap-2">
								<h:outputText value="#{t.prioridad}" styleClass="text-gray-600 font-medium">
								</h:outputText>
								<span class="fs-10 mr-1 text-gray-600">Prioridad</span>
								
							</div>
						</div>
					</div>
				</p:column>
				
				<p:column headerText="Vendedor" style="width:60px;" filterBy="#{t.usuario.nombrepantalla}" filterMatchMode="contains">
				
					<h:outputText value="#{t.usuario.nombrepantalla}" >
					</h:outputText>
					
				</p:column>
				
				<p:column headerText="Tarea" style="width:250px;" filterBy="#{t.etiqueta.etiqueta}" filterMatchMode="contains">					
					<div class="flex flex-column">						
						<h:outputText value="#{t.etiqueta.etiqueta}" styleClass="fs-12 text-gray-900 fw-5"/>
						<h:outputText value="#{t.descripcion}" styleClass="fs-11 text-gray-700"/>
						
					</div>
				</p:column>
				
				<p:column headerText="Cotización" style="width:200px;" filterBy="#{t.cabecera.numdocumento}" filterMatchMode="contains">					
					<div class="flex justify-content-between align-items-end">						
						<h:outputText value="#{facEmitidaCtrl.getFormatoNumDocumento(t.cabecera.numdocumento)}" styleClass="fs-12 text-gray-900 fw-5">
						</h:outputText>
						<div>
							<h:outputText value="#{t.cabecera.fechaemision}" styleClass="text-gray-900">
								<f:convertDateTime pattern="dd/MM/yyyy"/>
							</h:outputText>				
						</div>
					</div>
					<div class="flex flex-column gap-1">
						<h:outputText value="#{t.cabecera.cliente.razonsocial}" styleClass="fs-11 text-primary-600 font-semibold">
						</h:outputText>
						<h:outputText value="#{t.cabecera.cliente.identificacion}" styleClass="fs-11 text-gray-900">
						</h:outputText>
						<h:outputText value="#{t.cabecera.resumen}" styleClass="fs-11 text-gray-900 fw-5">
						</h:outputText>
						<h:outputText value="#{t.cabecera.estado}" styleClass="fs-11 text-green-600 font-semibold">
						</h:outputText>						
					</div>
				</p:column>
				
		</p:dataTable>
		
	</div>
	<div class="EmptyBox20"/>
</ui:composition>
